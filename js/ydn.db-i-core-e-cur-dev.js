(function (name, definition, context) {if (typeof context['module'] !== 'undefined' && context['module']['exports']) {context['module']['exports'] = definition.apply(context);}else if (typeof context['define'] !== 'undefined' && context['define'] === 'function' && context['define']['amd']) {define(name, [], definition);}else {context[name] = definition();}})('ydn', function () {var k,n=this;function r(a){return void 0!==a}function aa(a){a=a.split(".");for(var b=n,c;c=a.shift();)if(null!=b[c])b=b[c];else return null;return b}function ba(){}
function ca(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function v(a){return"array"==ca(a)}function w(a){var b=ca(a);return"array"==b||"object"==b&&"number"==typeof a.length}function x(a){return"string"==typeof a}function da(a){return"boolean"==typeof a}function y(a){return"number"==typeof a}function z(a){return"function"==ca(a)}function A(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ea="closure_uid_"+(1E9*Math.random()>>>0),fa=0;
function ga(a,b,c){return a.call.apply(a.bind,arguments)}function ha(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function B(a,b,c){B=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ga:ha;return B.apply(null,arguments)}
function ia(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var ja=Date.now||function(){return+new Date};function ka(a,b){var c=a.split("."),d=n;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&r(b)?d[e]=b:d[e]?d=d[e]:d=d[e]={}}
function C(a,b){function c(){}c.prototype=b.prototype;a.u=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Ib=function(a,c,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[c].apply(a,g)}};function la(a){a.prototype.then=a.prototype.then;a.prototype.$goog_Thenable=!0}function ma(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}};function na(a){if(Error.captureStackTrace)Error.captureStackTrace(this,na);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}C(na,Error);na.prototype.name="CustomError";var oa;function pa(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}var qa=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};
function ra(a){if(!sa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(ta,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(ua,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(va,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(wa,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(xa,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(ya,"&#0;"));return a}
var ta=/&/g,ua=/</g,va=/>/g,wa=/"/g,xa=/'/g,ya=/\x00/g,sa=/[\x00&<>"']/,za={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\","<":"<"},Aa={"'":"\\'"};
function Ba(a){a=String(a);for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0),f=c+1,g;if(!(g=za[d])){if(!(31<e&&127>e))if(d in Aa)d=Aa[d];else if(d in za)d=Aa[d]=za[d];else{e=d;g=d.charCodeAt(0);if(31<g&&127>g)e=d;else{if(256>g){if(e="\\x",16>g||256<g)e+="0"}else e="\\u",4096>g&&(e+="0");e+=g.toString(16).toUpperCase()}d=Aa[d]=e}g=d}b[f]=g}b.push('"')}function Ca(a,b){return a<b?-1:a>b?1:0};function Da(a,b){b.unshift(a);na.call(this,pa.apply(null,b));b.shift()}C(Da,na);Da.prototype.name="AssertionError";function Ea(a,b){throw new Da("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};function Fa(a,b,c){this.f=c;this.c=a;this.g=b;this.b=0;this.a=null}Fa.prototype.get=function(){var a;0<this.b?(this.b--,a=this.a,this.a=a.next,a.next=null):a=this.c();return a};Fa.prototype.put=function(a){this.g(a);this.b<this.f&&(this.b++,a.next=this.a,this.a=a)};function Ga(){this.b=this.a=null}var Ia=new Fa(function(){return new Ha},function(a){a.reset()},100);Ga.prototype.add=function(a,b){var c=Ia.get();c.a=a;c.b=b;c.next=null;this.b?this.b.next=c:this.a=c;this.b=c};function Ja(){var a=Ka,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function Ha(){this.next=this.b=this.a=null}Ha.prototype.reset=function(){this.next=this.b=this.a=null};var D=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(x(a))return x(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ma=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Na=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,
b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=x(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},Oa=Array.prototype.some?function(a,b,c){return Array.prototype.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};function Pa(a,b){var c=Qa(a,b,void 0);return 0>c?null:x(a)?a.charAt(c):a[c]}
function Qa(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Ra(a){if(!v(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Ta(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function Ua(a,b,c){return 2>=arguments.length?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a,b,c)}
function Va(a,b){if(!w(a)||!w(b)||a.length!=b.length)return!1;for(var c=a.length,d=Wa,e=0;e<c;e++)if(!d(a[e],b[e]))return!1;return!0}function Wa(a,b){return a===b};var Xa;a:{var Ya=n.navigator;if(Ya){var Za=Ya.userAgent;if(Za){Xa=Za;break a}}Xa=""}function E(a){return-1!=Xa.indexOf(a)};function $a(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function ab(a,b){for(var c=w(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],r(a));c++);return a}var bb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function cb(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<bb.length;f++)c=bb[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function eb(){return E("Opera")||E("OPR")};function fb(a){n.setTimeout(function(){throw a;},0)}var gb;
function hb(){var a=n.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!E("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=B(function(a){if(("*"==d||a.origin==d)&&a.data==
c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!E("Trident")&&!E("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(r(c.next)){c=c.next;var a=c.Ra;c.Ra=null;a()}};return function(a){d.next={Ra:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=document.createElement("SCRIPT");
b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){n.setTimeout(a,0)}};function ib(a,b){jb||kb();lb||(jb(),lb=!0);Ka.add(a,b)}var jb;function kb(){if(n.Promise&&n.Promise.resolve){var a=n.Promise.resolve(void 0);jb=function(){a.then(mb)}}else jb=function(){var a=mb;!z(n.setImmediate)||n.Window&&n.Window.prototype&&!E("Edge")&&n.Window.prototype.setImmediate==n.setImmediate?(gb||(gb=hb()),gb(a)):n.setImmediate(a)}}var lb=!1,Ka=new Ga;function mb(){for(var a=null;a=Ja();){try{a.a.call(a.b)}catch(b){fb(b)}Ia.put(a)}lb=!1};function nb(a,b){this.a=ob;this.i=void 0;this.f=this.b=this.c=null;this.g=this.h=!1;if(a!=ba)try{var c=this;a.call(b,function(a){pb(c,qb,a)},function(a){if(!(a instanceof rb))try{if(a instanceof Error)throw a;throw Error("Promise rejected.");}catch(b){}pb(c,sb,a)})}catch(d){pb(this,sb,d)}}var ob=0,qb=2,sb=3;function tb(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}tb.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};
var ub=new Fa(function(){return new tb},function(a){a.reset()},100);function vb(a,b,c){var d=ub.get();d.f=a;d.b=b;d.c=c;return d}nb.prototype.then=function(a,b,c){return wb(this,z(a)?a:null,z(b)?b:null,c)};la(nb);function xb(a){a.a==ob&&ib(function(){var a=new rb(void 0);yb(this,a)},a)}
function yb(a,b){if(a.a==ob)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==ob&&1==d?yb(c,b):(f?(d=f,d.next==c.f&&(c.f=d),d.next=d.next.next):zb(c),Ab(c,e,sb,b)))}a.c=null}else pb(a,sb,b)}function Bb(a,b){a.b||a.a!=qb&&a.a!=sb||Cb(a);a.f?a.f.next=b:a.b=b;a.f=b}
function wb(a,b,c,d){var e=vb(null,null,null);e.a=new nb(function(a,g){e.f=b?function(c){try{var e=b.call(d,c);a(e)}catch(p){g(p)}}:a;e.b=c?function(b){try{var e=c.call(d,b);!r(e)&&b instanceof rb?g(b):a(e)}catch(p){g(p)}}:g});e.a.c=a;Bb(a,e);return e.a}nb.prototype.l=function(a){this.a=ob;pb(this,qb,a)};nb.prototype.m=function(a){this.a=ob;pb(this,sb,a)};
function pb(a,b,c){if(a.a==ob){a==c&&(b=sb,c=new TypeError("Promise cannot resolve to itself"));a.a=1;var d;a:{var e=c,f=a.l,g=a.m;if(e instanceof nb)Bb(e,vb(f||ba,g||null,a)),d=!0;else if(ma(e))e.then(f,g,a),d=!0;else{if(A(e))try{var h=e.then;if(z(h)){Db(e,h,f,g,a);d=!0;break a}}catch(l){g.call(a,l);d=!0;break a}d=!1}}d||(a.i=c,a.a=b,a.c=null,Cb(a),b!=sb||c instanceof rb||Eb(a,c))}}
function Db(a,b,c,d,e){function f(a){h||(h=!0,d.call(e,a))}function g(a){h||(h=!0,c.call(e,a))}var h=!1;try{b.call(a,g,f)}catch(l){f(l)}}function Cb(a){a.h||(a.h=!0,ib(a.j,a))}function zb(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.f=null);return b}nb.prototype.j=function(){for(var a=null;a=zb(this);)Ab(this,a,this.a,this.i);this.h=!1};
function Ab(a,b,c,d){if(c==sb&&b.b&&!b.g)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Fb(b,c,d);else try{b.g?b.f.call(b.c):Fb(b,c,d)}catch(e){Gb.call(null,e)}ub.put(b)}function Fb(a,b,c){b==qb?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Eb(a,b){a.g=!0;ib(function(){a.g&&Gb.call(null,b)})}var Gb=fb;function rb(a){na.call(this,a)}C(rb,na);rb.prototype.name="cancel";/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
function F(a,b){this.j=[];this.N=b||null;this.b=this.c=!1;this.f=void 0;this.S=this.w=this.l=!1;this.h=0;this.i=null;this.C=0}k=F.prototype;k.ra=function(a,b){this.l=!1;Hb(this,a,b)};function Hb(a,b,c){a.c=!0;a.f=c;a.b=!b;a.Fa()}function Ib(a){if(a.c){if(!a.S)throw new Jb;a.S=!1}}k.callback=function(a){Ib(this);Hb(this,!0,a)};k.o=function(a){Ib(this);Hb(this,!1,a)};k.G=function(a,b){return Kb(this,a,null,b)};k.fb=function(a,b){return Kb(this,null,a,b)};k.Pa=function(a,b){return Kb(this,a,a,b)};
function Kb(a,b,c,d){a.j.push([b,c,d]);a.c&&a.Fa();return a}k.then=function(a,b,c){var d,e,f=new nb(function(a,b){d=a;e=b});Kb(this,d,function(a){e(a)});return f.then(a,b,c)};la(F);F.prototype.Ca=function(a){Kb(this,a.callback,a.o,a);return this};function Lb(a){return Oa(a.j,function(a){return z(a[1])})}
F.prototype.Fa=function(){this.h&&this.c&&Lb(this)&&(Mb(this.h),this.h=0);this.i&&(this.i.C--,delete this.i);for(var a=this.f,b=!1,c=!1;this.j.length&&!this.l;){var d=this.j.shift(),e=d[0],f=d[1],d=d[2];if(e=this.b?f:e)try{var g=e.call(d||this.N,a);r(g)&&(this.b=this.b&&(g==a||g instanceof Error),this.f=a=g);if(ma(a)||"function"===typeof n.Promise&&a instanceof n.Promise)this.l=c=!0}catch(h){a=h,this.b=!0,Lb(this)||(b=!0)}}this.f=a;c&&(c=B(this.ra,this,!0),g=B(this.ra,this,!1),a instanceof F?(Kb(a,
c,g),a.w=!0):a.then(c,g));b&&(a=new Nb(a),Ob[a.a]=a,this.h=a.a)};function Jb(){na.call(this)}C(Jb,na);Jb.prototype.message="Deferred has already fired";Jb.prototype.name="AlreadyCalledError";function Nb(a){this.a=n.setTimeout(B(this.c,this),0);this.b=a}Nb.prototype.c=function(){delete Ob[this.a];window.console.error(this.b.stack);throw this.b;};var Ob={};function Mb(a){var b=Ob[a];b&&(n.clearTimeout(b.a),delete Ob[a])};var Pb={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function Qb(){this.a="";this.b=Rb}Qb.prototype.O=!0;Qb.prototype.I=function(){return this.a};Qb.prototype.toString=function(){return"Const{"+this.a+"}"};function Sb(a){if(a instanceof Qb&&a.constructor===Qb&&a.b===Rb)return a.a;Ea("expected object of type Const, got '"+a+"'");return"type_error:Const"}var Rb={};function Tb(a){var b=new Qb;b.a=a;return b};function Ub(){this.a="";this.b=Vb}Ub.prototype.O=!0;var Vb={};Ub.prototype.I=function(){return this.a};Ub.prototype.toString=function(){return"SafeStyle{"+this.a+"}"};function Wb(a){var b=new Ub;b.a=a;return b}var Xb=Wb(""),Zb=/^[-,."'%_!# a-zA-Z0-9]+$/;function $b(){this.a="";this.b=ac}k=$b.prototype;k.O=!0;k.I=function(){return this.a};k.Ha=!0;k.V=function(){return 1};k.toString=function(){return"SafeUrl{"+this.a+"}"};function bc(a){if(a instanceof $b&&a.constructor===$b&&a.b===ac)return a.a;Ea("expected object of type SafeUrl, got '"+a+"'");return"type_error:SafeUrl"}var cc=/^(?:(?:https?|mailto|ftp):|[^&:/?#]*(?:[/?#]|$))/i;
function dc(a){if(a instanceof $b)return a;a=a.O?a.I():String(a);cc.test(a)||(a="about:invalid#zClosurez");return ec(a)}var ac={};function ec(a){var b=new $b;b.a=a;return b};function fc(){this.a=gc}k=fc.prototype;k.O=!0;k.I=function(){return""};k.Ha=!0;k.V=function(){return 1};k.toString=function(){return"TrustedResourceUrl{}"};var gc={};function hc(){this.a="";this.c=ic;this.b=null}k=hc.prototype;k.Ha=!0;k.V=function(){return this.b};k.O=!0;k.I=function(){return this.a};k.toString=function(){return"SafeHtml{"+this.a+"}"};function jc(a){if(a instanceof hc&&a.constructor===hc&&a.c===ic)return a.a;Ea("expected object of type SafeHtml, got '"+a+"'");return"type_error:SafeHtml"}function kc(a){if(a instanceof hc)return a;var b=null;a.Ha&&(b=a.V());a=ra(a.O?a.I():String(a));return lc(a,b)}
function mc(a){if(a instanceof hc)return a;a=kc(a);var b;b=jc(a).replace(/  /g," &#160;").replace(/(\r\n|\r|\n)/g,"<br>");return lc(b,a.V())}var nc=/^[a-zA-Z0-9-]+$/,oc={action:!0,cite:!0,data:!0,formaction:!0,href:!0,manifest:!0,poster:!0,src:!0},pc={APPLET:!0,BASE:!0,EMBED:!0,IFRAME:!0,LINK:!0,MATH:!0,OBJECT:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0};
function qc(a,b,c){if(!nc.test(a))throw Error("Invalid tag name <"+a+">.");if(a.toUpperCase()in pc)throw Error("Tag name <"+a+"> is not allowed for SafeHtml.");var d=null,e="<"+a;if(b)for(var f in b){if(!nc.test(f))throw Error('Invalid attribute name "'+f+'".');var g=b[f];if(null!=g){var h,l=a;h=f;if(g instanceof Qb)g=Sb(g);else if("style"==h.toLowerCase()){if(!A(g))throw Error('The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof g+" given: "+g);if(!(g instanceof
Ub)){var l="",p=void 0;for(p in g){if(!/^[-_a-zA-Z0-9]+$/.test(p))throw Error("Name allows only [-_a-zA-Z0-9], got: "+p);var t=g[p];if(null!=t){if(t instanceof Qb)t=Sb(t);else if(Zb.test(t)){for(var m=!0,q=!0,u=0;u<t.length;u++){var G=t.charAt(u);"'"==G&&q?m=!m:'"'==G&&m&&(q=!q)}m&&q||(Ea("String value requires balanced quotes, got: "+t),t="zClosurez")}else Ea("String value allows only [-,.\"'%_!# a-zA-Z0-9], got: "+t),t="zClosurez";l+=p+":"+t+";"}}g=l?Wb(l):Xb}l=void 0;g instanceof Ub&&g.constructor===
Ub&&g.b===Vb?l=g.a:(Ea("expected object of type SafeStyle, got '"+g+"'"),l="type_error:SafeStyle");g=l}else{if(/^on/i.test(h))throw Error('Attribute "'+h+'" requires goog.string.Const value, "'+g+'" given.');if(h.toLowerCase()in oc)if(g instanceof fc)g instanceof fc&&g.constructor===fc&&g.a===gc?g="":(Ea("expected object of type TrustedResourceUrl, got '"+g+"'"),g="type_error:TrustedResourceUrl");else if(g instanceof $b)g=bc(g);else if(x(g))g=dc(g).I();else throw Error('Attribute "'+h+'" on tag "'+
l+'" requires goog.html.SafeUrl, goog.string.Const, or string, value "'+g+'" given.');}g.O&&(g=g.I());h=h+'="'+ra(String(g))+'"';e=e+(" "+h)}}null!=c?v(c)||(c=[c]):c=[];!0===Pb[a.toLowerCase()]?e+=">":(d=rc(c),e+=">"+jc(d)+"</"+a+">",d=d.V());(a=b&&b.dir)&&(/^(ltr|rtl|auto)$/i.test(a)?d=0:d=null);return lc(e,d)}function rc(a){function b(a){v(a)?Ma(a,b):(a=kc(a),d+=jc(a),a=a.V(),0==c?c=a:0!=a&&c!=a&&(c=null))}var c=0,d="";Ma(arguments,b);return lc(d,c)}var ic={};
function lc(a,b){var c=new hc;c.a=a;c.b=b;return c}lc("<!DOCTYPE html>",0);var sc=lc("",0);var tc="StopIteration"in n?n.StopIteration:{message:"StopIteration",stack:""};function uc(){}uc.prototype.next=function(){throw tc;};uc.prototype.Ba=function(){return this};function vc(a){if(a instanceof uc)return a;if("function"==typeof a.Ba)return a.Ba(!1);if(w(a)){var b=0,c=new uc;c.next=function(){for(;;){if(b>=a.length)throw tc;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");}
function wc(a,b){if(w(a))try{Ma(a,b,void 0)}catch(c){if(c!==tc)throw c;}else{a=vc(a);try{for(;;)b.call(void 0,a.next(),void 0,a)}catch(c){if(c!==tc)throw c;}}};function xc(a,b){this.b={};this.a=[];this.f=this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)yc(this,arguments[d],arguments[d+1])}else if(a){var e;if(a instanceof xc)e=a.U(),d=a.Ga();else{var c=[],f=0;for(e in a)c[f++]=e;e=c;c=[];f=0;for(d in a)c[f++]=a[d];d=c}for(c=0;c<e.length;c++)yc(this,e[c],d[c])}}k=xc.prototype;k.Ta=function(){return this.c};k.Ga=function(){zc(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a};
k.U=function(){zc(this);return this.a.concat()};k.clear=function(){this.b={};this.f=this.c=this.a.length=0};function zc(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];Object.prototype.hasOwnProperty.call(a.b,d)&&(a.a[c++]=d);b++}a.a.length=c}if(a.c!=a.a.length){for(var e={},c=b=0;b<a.a.length;)d=a.a[b],Object.prototype.hasOwnProperty.call(e,d)||(a.a[c++]=d,e[d]=1),b++;a.a.length=c}}k.get=function(a,b){return Object.prototype.hasOwnProperty.call(this.b,a)?this.b[a]:b};
function yc(a,b,c){Object.prototype.hasOwnProperty.call(a.b,b)||(a.c++,a.a.push(b),a.f++);a.b[b]=c}k.forEach=function(a,b){for(var c=this.U(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};k.clone=function(){return new xc(this)};k.Ba=function(a){zc(this);var b=0,c=this.f,d=this,e=new uc;e.next=function(){if(c!=d.f)throw Error("The map has changed since the iterator was created");if(b>=d.a.length)throw tc;var e=d.a[b++];return a?e:d.b[e]};return e};function Ac(){return E("iPhone")&&!E("iPod")&&!E("iPad")};var Bc=eb(),Cc=E("Trident")||E("MSIE"),Dc=E("Edge"),Ec=E("Gecko")&&!(-1!=Xa.toLowerCase().indexOf("webkit")&&!E("Edge"))&&!(E("Trident")||E("MSIE"))&&!E("Edge"),Fc=-1!=Xa.toLowerCase().indexOf("webkit")&&!E("Edge");function Gc(){var a=Xa;if(Ec)return/rv\:([^\);]+)(\)|;)/.exec(a);if(Dc)return/Edge\/([\d\.]+)/.exec(a);if(Cc)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(Fc)return/WebKit\/(\S+)/.exec(a)}function Hc(){var a=n.document;return a?a.documentMode:void 0}
var Ic=function(){if(Bc&&n.opera){var a;var b=n.opera.version;try{a=b()}catch(c){a=b}return a}a="";(b=Gc())&&(a=b?b[1]:"");return Cc&&(b=Hc(),b>parseFloat(a))?String(b):a}(),Lc={};
function Mc(a){var b;if(!(b=Lc[a])){b=0;for(var c=qa(String(Ic)).split("."),d=qa(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",l=RegExp("(\\d*)(\\D*)","g"),p=RegExp("(\\d*)(\\D*)","g");do{var t=l.exec(g)||["","",""],m=p.exec(h)||["","",""];if(0==t[0].length&&0==m[0].length)break;b=Ca(0==t[1].length?0:parseInt(t[1],10),0==m[1].length?0:parseInt(m[1],10))||Ca(0==t[2].length,0==m[2].length)||Ca(t[2],m[2])}while(0==b)}b=Lc[a]=0<=b}return b}
var Nc=n.document,Oc=Nc&&Cc?Hc()||("CSS1Compat"==Nc.compatMode?parseInt(Ic,10):5):void 0;function Pc(a){var b;b=Error();if(Error.captureStackTrace)Error.captureStackTrace(b,a||Pc),b=String(b.stack);else{try{throw b;}catch(c){b=c}b=(b=b.stack)?String(b):null}b||(b=Qc(a||arguments.callee.caller,[]));return b}
function Qc(a,b){var c=[];if(0<=D(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(Rc(a)+"(");for(var d=a.arguments,e=0;d&&e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=Rc(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(Qc(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?
c.push("[...long stack...]"):c.push("[end]");return c.join("")}function Rc(a){if(Sc[a])return Sc[a];a=String(a);if(!Sc[a]){var b=/function ([^\(]+)/.exec(a);Sc[a]=b?b[1]:"[Anonymous]"}return Sc[a]}var Sc={};function Tc(a,b,c,d,e){this.reset(a,b,c,d,e)}Tc.prototype.a=null;var Uc=0;Tc.prototype.reset=function(a,b,c,d,e){"number"==typeof e||Uc++;this.g=d||ja();this.f=a;this.c=b;this.b=c;delete this.a};function Vc(a){this.g=a;this.a=this.f=this.b=this.c=null}function Wc(a,b){this.name=a;this.value=b}Wc.prototype.toString=function(){return this.name};var Xc=new Wc("SHOUT",1200),Yc=new Wc("SEVERE",1E3),Zc=new Wc("WARNING",900),$c=new Wc("INFO",800),ad=new Wc("CONFIG",700),bd=new Wc("FINE",500),cd=new Wc("FINER",400),dd=new Wc("FINEST",300),ed=[new Wc("OFF",Infinity),Xc,Yc,Zc,$c,ad,bd,cd,dd,new Wc("ALL",0)],fd=null;Vc.prototype.getName=function(){return this.g};
function gd(a){if(a.b)return a.b;if(a.c)return gd(a.c);Ea("Root logger has no level set.");return null}Vc.prototype.log=function(a,b,c){if(a.value>=gd(this).value)for(z(b)&&(b=b()),a=new Tc(a,String(b),this.g),c&&(a.a=c),c="log:"+a.c,n.console&&(n.console.timeStamp?n.console.timeStamp(c):n.console.markTimeline&&n.console.markTimeline(c)),n.msWriteProfilerMark&&n.msWriteProfilerMark(c),c=this;c;){b=c;var d=a;if(b.a)for(var e=0,f=void 0;f=b.a[e];e++)f(d);c=c.c}};
Vc.prototype.config=function(a,b){this.log(ad,a,b)};var hd={},id=null;function jd(){id||(id=new Vc(""),hd[""]=id,id.b=ad)}function kd(){jd();return id}function H(a){jd();var b;if(!(b=hd[a])){b=new Vc(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=H(a.substr(0,c));c.f||(c.f={});c.f[d]=b;b.c=c;hd[a]=b}return b};function ld(a,b,c){a&&a.log(b,c,void 0)}function md(a,b){a&&a.log(Zc,b,void 0)}function nd(a,b){a&&a.log(bd,b,void 0)};function I(a,b){a&&a.log(dd,b,void 0)}function J(a,b){a&&a.log(cd,b,void 0)};function K(a){na.call(this,a);this.name="ydn.error.ArgumentException"}C(K,na);function od(a){na.call(this,a);this.name="ydn.error.TypeError"}C(od,na);function pd(a){na.call(this,a);this.name="ydn.error.NotSupportedException"}C(pd,na);function qd(a){na.call(this,a);this.name="ydn.error.InvalidOperationException"}C(qd,na);function rd(a){Error.captureStackTrace?Error.captureStackTrace(this,rd):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}C(rd,Error);
rd.prototype.name="ydn.error.InternalError";function sd(a,b){F.call(this,0,b);this.g=[]}C(sd,F);k=sd.prototype;k.Qa=function(a,b){this.g.push([a,b]);return this};function td(a,b){for(var c=0;c<a.g.length;c++)a.g[c][0].call(a.g[c][1],b)}k.callback=function(a){this.g.length=0;sd.u.callback.call(this,a)};k.o=function(a){this.g.length=0;sd.u.o.call(this,a)};k.Ca=function(a){sd.u.Ca.call(this,a);a instanceof sd&&a.Qa(function(a){td(this,a)},this);return this};k.sb=function(){return this};var ud={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},L=ud.READ_ONLY,M=ud.READ_WRITE,vd=ud.VERSION_CHANGE,wd=n.indexedDB;F.prototype.done=F.prototype.G;F.prototype.fail=F.prototype.fb;F.prototype.always=F.prototype.Pa;sd.prototype.then=sd.prototype.then;function xd(a,b){var c,d;2==arguments.length&&x(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=w(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],r(a));c++);return a}var yd={};
function zd(a){a=[a];for(var b=new Ad,c=0,d,e;void 0!==(e=a.pop());){0===c%4&&12<c+4&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=4,0<e.length){a.push(yd);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=1,b.write(c),Bd(b,e);else if(e instanceof Date)c+=2,b.write(c),Bd(b,e.valueOf());else if("string"===d){c+=3;b.write(c);c=b;for(d=0;d<e.length;d++){var f=e.charCodeAt(d);126>=f?c.write(f+1):16510>=f?(f-=127,c.write(128|f>>8,f&255)):c.write(192|f>>10,f>>
2|255,(f|3)<<6)}c.write(0)}else if(e===yd)b.write(0);else return"";c=0}return b.trim().toString()}
function Bd(a,b){var c,d,e;c=b;var f=e=d=0;if(0!==c)if(isFinite(c)){0>c&&(d=1,c=-c);f=0;if(2.2250738585072014E-308<=c){for(e=c;1>e;)f--,e*=2;for(;2<=e;)f++,e/=2;e=f+1023}f=e?Math.floor(4503599627370496*(c/Math.pow(2,f)-1)):Math.floor(c/4.9E-324)}else e=2047,isNaN(c)?f=0x8000000000000:-Infinity===c&&(d=1);c=d;d=e;e=f;c&&(e=0xfffffffffffff-e,d=2047-d);a.write((c?0:128)|d>>4);a.write((d&15)<<4|0|e/281474976710656);e%=281474976710656;c=0|e/4294967296;a.write(c>>8,c&255);e%=4294967296;c=0|e/65536;a.write(c>>
8,c&255);c=e%65536;a.write(c>>8,c&255)}function Ad(){this.a=[];this.b=void 0}Ad.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.b=arguments[b].toString(16),this.a.push(2===this.b.length?this.b:this.b="0"+this.b)};Ad.prototype.trim=function(){for(var a=this.a.length;"00"===this.a[--a];);this.a.length=++a;return this};Ad.prototype.toString=function(){return this.a.length?this.a.join(""):""};function Cd(a,b){var c=zd(a),d=zd(b);return c>d?1:c==d?0:-1};function Dd(a,b,c){sd.call(this,0,c);this.v=a;this.g=[];this.m=[];this.$=[];this.a=null;this.ha=""}C(Dd,sd);k=Dd.prototype;k.ha="";k.logger=H("ydn.db.Request");function Ed(a,b,c){a.a=b;a.ha=c;J(a.logger,a+" BEGIN");if(b){for(c=0;c<a.m.length;c++)a.m[c][0].call(a.m[c][1],b);a.m.length=0}}function Fd(a){J(a.logger,a+" END");a.a=null}k.gb=function(){return!!this.a};
k.abort=function(){J(this.logger,this+" aborting "+this.a);if(this.a)if(z(this.a.abort))this.a.abort();else if(z(this.a.executeSql))this.a.executeSql("ABORT",[],function(){},function(){return!0});else throw new pd;else throw new Gd(this+" No active transaction");};function N(a,b,c){var d=a.$.shift();c=!!c;d?d[0].call(d[1],b,c,function(b,c){N(a,b,c)}):c?a.o(b):a.callback(b)}function Hd(a,b,c){a.$.push([b,c])}function O(a,b,c){a.a?b.call(c,a.a):a.m.push([b,c])}
k.callback=function(a){J(this.logger,this+" SUCCESS");Dd.u.callback.call(this,a)};k.o=function(a){J(this.logger,this+" ERROR");Dd.u.o.call(this,a)};function Q(a){var b="";a.ha&&(b=a.a?"*":"",b="["+a.ha+b+"]");return a.v+b}function Id(a,b){var c=new Dd(a);N(c,b);return c}k.toString=function(){return"Request:"+Q(this)};
k.Fa=function(){this.h&&this.c&&Lb(this)&&(Mb(this.h),this.h=0);this.i&&(this.i.C--,delete this.i);for(var a=this.f,b=!1;this.j.length&&!this.l;){var c=this.j.shift(),d=c[0],e=c[1],c=c[2];if(d=this.b?e:d)d=d.call(c||this.N,a),r(d)&&(this.b=this.b&&(d==a||d instanceof Error),this.f=a=d),ma(a)&&(this.l=b=!0)}this.f=a;b&&(b=B(this.ra,this,!0),d=B(this.ra,this,!1),a instanceof F?(Kb(a,b,d),a.w=!0):a.then(b,d))};
k.toJSON=function(){var a=(this.ha||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.v?this.v.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};var Kd=wd&&wd.cmp?B(wd.cmp,wd):Cd,Ld=[];var Md=E("Safari")&&!((E("Chrome")||E("CriOS"))&&!eb()&&!E("Edge")||E("Coast")||eb()||E("Edge")||E("Silk")||E("Android"))&&!(Ac()||E("iPad")||E("iPod"));function Nd(){0!=Od&&(Pd[this[ea]||(this[ea]=++fa)]=this);this.m=this.m;this.v=this.v}var Od=0,Pd={};Nd.prototype.m=!1;Nd.prototype.Sa=function(){if(!this.m&&(this.m=!0,this.L(),0!=Od)){var a=this[ea]||(this[ea]=++fa);delete Pd[a]}};Nd.prototype.L=function(){if(this.v)for(;this.v.length;)this.v.shift()()};function Qd(a,b){this.type=a;this.a=this.target=b;this.Xa=!0}Qd.prototype.preventDefault=function(){this.Xa=!1};function Rd(a,b){Qd.call(this,a,b)}C(Rd,Qd);Rd.prototype.c=function(){return this.b};function Sd(a,b,c,d,e){Qd.call(this,a,b);this.version=c;this.$a=d;this.Va=e}C(Sd,Rd);k=Sd.prototype;k.name="ReadyEvent";k.version=NaN;k.$a=NaN;k.Va=null;k.Gb=function(){return this.version};k.jb=function(){return this.$a};k.ib=function(){return this.Va};function Td(a,b,c){Qd.call(this,c||"error",a);this.error=b}C(Td,Rd);Td.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};
Td.prototype.name="ErrorEvent";Td.prototype.error=null;Td.prototype.f=function(){return this.error};function Ud(a,b){Td.call(this,a,b,"fail")}C(Ud,Td);Ud.prototype.name="FailEvent";function Vd(a,b,c,d,e){Qd.call(this,a,b);this.b=c;this.key=d;this.value=e}C(Vd,Rd);Vd.prototype.name="RecordEvent";Vd.prototype.f=function(){return this.key};Vd.prototype.g=function(){return this.value};function Wd(a,b,c,d,e){Qd.call(this,a,b);this.b=c;this.keys=d;this.values=e}C(Wd,Rd);Wd.prototype.name="StoreEvent";
Wd.prototype.U=function(){return this.keys};Wd.prototype.Ga=function(){return this.values};function Xd(a,b,c){var d;if(A(a))d=a.store,b=a.id,null!=a.parent&&(c=new Xd(a.parent));else if(r(b))d=a;else if(d=a.lastIndexOf("^|"),b=a,0<d&&(b=a.substr(d),c=new Xd(a.substring(0,d))),b=b.split("^:"),d=b[0],b=b[1],!r(b))throw Error("Invalid key value: "+a);this.a=d;this.id=b;this.b=c||null}k=Xd.prototype;k.toJSON=function(){var a={store:this.a,id:this.id};this.b&&(a.parent=this.b.toJSON());return a};k.valueOf=function(){return(this.b?this.b.valueOf()+"^|":"")+this.a+"^:"+this.id};
k.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};k.Bb=function(){return this.a};k.hb=function(){return this.id};k.Ab=function(){return this.b};function Yd(a){if(w(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};function R(a,b,c,d){a>b&&(b=a=void 0);null===a&&(a=void 0);null===b&&(b=void 0);this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d}k=R.prototype;k.lower=void 0;k.upper=void 0;k.lowerOpen=!1;k.upperOpen=!1;k.toJSON=function(){return Zd(this)};function $d(a){return ae(a)}function be(a){return new R(a,a,!1,!1)}function ce(a,b,c,d){return new R(a,b,c,d)}function de(a,b){return new R(void 0,a,void 0,!!b)}function ee(a,b){return new R(a,void 0,!!b,void 0)}
function fe(a){var b;if(v(a))b=Ta(a),b.push("\uffff");else if(x(a))b=a+"\uffff";else if(y(a))b=a+2.220460492503131E-16,a-=2.220460492503131E-16;else return be(a);return ce(a,b,!1,!0)}function Zd(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}}
function ae(a){return null!=a?null!=a.upper&&null!=a.lower?ge.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):null!=a.upper?ge.upperBound(a.upper,a.upperOpen):null!=a.lower?ge.lowerBound(a.lower,a.lowerOpen):null:null}function he(a){if(a instanceof R)return"";if(null!=a){if(A(a)){for(var b in a){var c;if(c=a.hasOwnProperty(b))c=!(0<=D(["lower","upper","lowerOpen","upperOpen"],b));if(c)return'invalid attribute "'+b+'" in key range object'}return""}return"key range must be an object"}return""}
function ie(a,b,c,d){var e,f,g,h;if("starts"==a||"^"==a)return fe(b);if("<"==a||"<="==a)e=b,g="<"==a;else if(">"==a||">="==a)f=b,h=">"==a;else if("="==a||"=="==a)e=f=b;else throw new K("invalid op: "+a);if("<"==c||"<="==c)e=d,g="<"==c;else if(">"==c||">="==c)f=d,h=">"==c;else if(r(c))throw new K("invalid op2: "+c);return ce(f,e,h,g)}var ge=n.IDBKeyRange||n.webkitIDBKeyRange||R;function je(a,b,c,d,e,f){r(e)||(e=v(a)?a.join(", "):a);if(null!=a&&!x(a)&&!w(a))throw new K("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);v(a)&&Object.freeze&&Object.freeze(a);!r(a)&&r(e)&&(a=e.replace(/[,\s]/g,""));this.keyPath=a;this.g=w(this.keyPath);this.a=e;this.type=ke(b);if(r(b)){if(!r(this.type))throw new K("type invalid in index: "+this.a);if(v(this.keyPath))throw new K('composite key for store "'+this.a+'" must not specified type');}this.unique=!!c;this.multiEntry=
!!d;this.f=x(e)?e:v(a)?this.keyPath.join(","):a;Ba(this.f);this.b=this.g?null:this.keyPath.split(".");this.c=f||null}var le=["BLOB","DATE","INTEGER","NUMERIC","TEXT"];function ke(a){if(x(a))return a=D(le,a),le[a]}k=je.prototype;k.getName=function(){return this.a};k.toJSON=function(){return{name:this.a,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};
k.clone=function(){var a=v(this.keyPath)?Ta(this.keyPath):this.keyPath;return new je(a,this.type,this.unique,this.multiEntry,this.a,this.c)};function me(a,b){return null!=a||null!=b?null!=a?null!=b?w(a)&&w(b)?Va(a,b)?null:"expect: "+a+", but: "+b:ne(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null}
k.hint=function(a){if(!a)return this;var b=v(this.keyPath)?Ta(this.keyPath):this.keyPath,c=this.type;r(a.type)||"TEXT"!=c||(c=void 0);return new je(b,c,this.unique,this.multiEntry,a.a)};k.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.b&&1<this.b.length&&(a+="Compound");return a+"Index:"+this.a};function oe(a,b,c,d,e,f,g,h){if(!x(a))throw new K("store name must be a string");this.c=a;this.keyPath=r(b)?b:null;this.g=w(this.keyPath);if(null!==this.keyPath&&!x(this.keyPath)&&!this.g)throw new K("keyPath must be a string or array");if(null!=c&&!da(c))throw new K('invalid autoIncrement value in store "'+a+'"');this.b=!!c;var l;if(null!=d){l=ke(d);if(!r(l))throw new K('type "'+d+'" for primary key in store "'+this.c+'" is invalid.');if(this.g)throw new K('composite key for store "'+this.c+'" must not specified type');
}this.type=null!=l?l:this.b?"INTEGER":void 0;this.f=x(this.keyPath)?this.keyPath.split("."):[];this.a=e||[];a=[];for(b=0;b<this.a.length;b++){c=this.a[b].getName();if(0<=a.indexOf(c))throw new K('index "'+c+'" already defined in store: '+this.c);a.push(c)}this.H=!!f;this.ab=!!g;this.j=v(this.keyPath)?this.keyPath.join(","):x(this.keyPath)?this.keyPath:"_ROWID_";Ba(this.j);if(this.i=!!h){if(this.keyPath)throw new K('encrypted store "'+this.c+'" must not use inline key');if(this.b)throw new K('encrypted store "'+
this.c+'" must not use key generator');}this.h=[]}k=oe.prototype;k.H=!1;k.ab=!1;k.toJSON=function(){for(var a=[],b=0;b<this.a.length;b++)a.push(this.a[b].toJSON());return{name:this.c,keyPath:this.keyPath,autoIncrement:this.b,type:this.type,indexes:a}};
function pe(a){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==D(b,c))throw new K('Unknown attribute "'+c+'"');b=[];c=a.indexes||[];if(v(c))for(var d=0;d<c.length;d++){var e;e=c[d];var f="name unique type keyPath multiEntry generator".split(" "),g=void 0;for(g in e)if(e.hasOwnProperty(g)&&-1==D(f,g))throw new K("Unknown field: "+g+" in "+qe(e));e=new je(e.keyPath,e.type,e.unique,e.multiEntry,e.name,e.generator);
r(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new oe(a.name,a.keyPath,a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)}k.clone=function(){return pe(this.toJSON())};k.index=function(a){return this.a[a]||null};function re(a,b){return Pa(a.a,function(a){return a.getName()==b})}function se(a,b){return b===a.keyPath?!0:Oa(a.a,function(a){return a.getName()==b})}k.getName=function(){return this.c};
function te(a,b,c){if(b){if(!a.keyPath&&null!=c)return c;if(a.g){c=[];for(var d=0;d<a.keyPath.length;d++)c.push(xd(b,a.keyPath[d]));return c}if(a.keyPath)return ab(b,a.f)}}function ue(a,b,c){for(var d=0;d<a.f.length;d++){var e=a.f[d];if(d==a.f.length-1){b[e]=c;break}r(b[e])||(b[e]={});b=b[e]}}
function ve(a,b){if(!b)return"missing store: "+a.c;if(a.c!=b.c)return"store name, expect: "+a.c+", but: "+b.c;var c=me(a.keyPath,b.keyPath);if(c)return"keyPath, "+c;if(r(a.b)&&r(b.b)&&a.b!=b.b)return"autoIncrement, expect:  "+a.b+", but: "+b.b;if(a.a.length!=b.a.length)return"indexes length, expect:  "+a.a.length+", but: "+b.a.length;if(r(a.type)&&r(b.type)&&(w(a.type)?!Va(a.type,b.type):a.type!=b.type))return"data type, expect:  "+a.type+", but: "+b.type;for(c=0;c<a.a.length;c++){var d=re(b,a.a[c].getName()),
e;e=a.a[c];if(d)if(e.a!=d.a)e="name, expect: "+e.a+", but: "+d.a;else{var f=me(e.keyPath,d.keyPath);e=f?"keyPath, "+f:null!=e.unique&&null!=d.unique&&e.unique!=d.unique?"unique, expect: "+e.unique+", but: "+d.unique:null!=e.multiEntry&&null!=d.multiEntry&&e.multiEntry!=d.multiEntry?"multiEntry, expect: "+e.multiEntry+", but: "+d.multiEntry:r(e.type)&&r(d.type)&&(w(e.type)?!Va(e.type,d.type):e.type!=d.type)?"data type, expect: "+e.type+", but: "+d.type:""}else e="no index for "+e.a;if(0<e.length)return'index "'+
a.a[c].getName()+'" '+e}return""}function we(a,b){if(b)for(var c=0;c<a.a.length;c++){var d=a.a[c],e=b;if(d.c){var f=d.c(e),g=typeof f;if("string"==g||"number"==g||f instanceof Date||v(f)){for(g=0;g<d.b.length-1;g++)A(e[d.b[g]])||(e[d.b[g]]={});e[d.b[d.b.length-1]]=f}}}}function xe(a,b,c,d,e){for(var f=0;f<a.h.length;f++)d!==f&&a.h[f].call(e,b,c)}k.toString=function(){return"Store:"+this.c+"["+this.a.length+"index]"};function ye(a){var b;try{b=qe(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""}function qe(a){return JSON.stringify(a,void 0,void 0)};function ze(a,b){if(!a||/^[\s\xa0]*$/.test(a))throw new K("store_name must be provided for primary full text index");if(!b||/^[\s\xa0]*$/.test(b))throw new K("index_name must be provided for primary full text index");this.a=a};function Ae(a,b,c){this.name=a;this.a=b;this.b=c||"";if(-1==["","en","fr"].indexOf(this.b))throw new K('Unsupported lang "'+c+" for full text search index "+a);}Ae.prototype.getName=function(){return this.name};Ae.prototype.count=function(){return this.a.length};Ae.prototype.index=function(a){return this.a[a]};
function Be(a){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==D(b,c))throw new K("Unknown field: "+c+" in "+qe(a));if(!v(a.sources))throw new K("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==D(b,c))throw new K("Unknown field: "+c+" in "+ye(a));return new ze(a.storeName,a.keyPath)});return new Ae(a.name,
b,a.lang)};function Ce(a,b){var c,d,e=b;if(A(a)){d=a;c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==D(c,f))throw new K("Unknown field: "+f+" in schema.");c=d.version;var e=[],g=d.stores||[];if(!v(g))throw new K("stores must be array");for(f=0;f<g.length;f++){var h=pe(g[f]);if(-1!=Qa(e,function(a){return a.name==h.getName()}))throw new K('duplicate store name "'+h.getName()+'".');e.push(h)}}else x(a)?c=0==a.length?void 0:parseFloat(a):y(a)&&(c=a);if(r(c)){if(!y(c)||0>c)throw new K("Invalid version: "+
c+" ("+a+")");isNaN(c)&&(c=void 0)}if(r(b)&&(!v(b)||0<b.length&&!(b[0]instanceof oe)))throw new K("stores");this.version=c;this.wa=!r(this.version);this.stores=e||[];c=[];if(d&&d.fullTextCatalogs)for(f=0;f<d.fullTextCatalogs.length;f++)e=Be(d.fullTextCatalogs[f]),c[f]=e,S(this,e.getName())||(g=[new je("k","TEXT"),new je("v","TEXT")],e=new oe(e.getName(),"id",!1,void 0,g,!1,!1,!1),this.stores.push(e));this.a=c}k=Ce.prototype;
k.toJSON=function(){var a=Na(this.stores,function(a){return a.toJSON()}),b={};b.stores=a;r(this.version)&&(b.version=this.version);return b};k.wa=!1;k.J=function(){return!1};function De(a){return Na(a.stores,function(a){return a.getName()})}k.qb=function(a){return this.stores[a]||null};k.count=function(){return this.stores.length};function S(a,b){return Pa(a.stores,function(a){return a.getName()==b})}function Ee(a,b){return Oa(a.stores,function(a){return a.getName()==b})}
function Fe(a,b){if(!b||a.stores.length!=b.stores.length)return"Number of store: "+a.stores.length+" vs "+b.stores.length;for(var c=0;c<a.stores.length;c++){var d=S(b,a.stores[c].getName());if(d){for(var e=d,f=a.stores[c],g=0;g<f.a.length;g++){var h=f.a[g];se(e,h.getName())||"BLOB"!=h.type||(h=new je(h.keyPath,h.type,h.unique,h.multiEntry,h.getName()),e.a.push(h))}d=ve(a.stores[c],d);if(0<d.length)return'store: "'+a.stores[c].getName()+'" '+d}else return'missing object store "'+a.stores[c].getName()+
'"'}return""};function Ge(a,b){Ce.call(this,a,b)}C(Ge,Ce);Ge.prototype.J=function(){return!0};function He(a,b){a.stores.push(b)};function Ie(a){Error.captureStackTrace?Error.captureStackTrace(this,Ie):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"}C(Ie,Error);C(Ie,Error);function Je(a){Error.captureStackTrace?Error.captureStackTrace(this,Je):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"}C(Je,Error);
function Ke(a){Error.captureStackTrace?Error.captureStackTrace(this,Ke):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}C(Ke,Error);Ke.prototype.name="ydn.InternalError";function Le(a){Error.captureStackTrace?Error.captureStackTrace(this,Le):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"}C(Le,Error);Le.prototype.name="ydn.error.ConstraintError";
function Me(a){Error.captureStackTrace?Error.captureStackTrace(this,Me):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"}C(Ie,Error);function Ne(a){Error.captureStackTrace?Error.captureStackTrace(this,Ne):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"}C(Ne,Error);function ne(a,b){var c;c=c||{};if(null!=a&&null!=b){if(w(a)&&w(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(-1==Qa(b,function(b){return ne(b,a[d])}))return!1;return!0}if(w(a))return 1==a.length&&ne(a[0],b);if(w(b))return 1==b.length&&ne(b[0],a);if(A(a)&&A(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=ne(a[e],b[e]);if(!f)return!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=ne(a[e],b[e]),!f))return!1;return!0}return a===b}return!1};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function T(a,b,c){c=c||{};var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==D(d,e))throw new K('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!v(c.mechanisms))throw new K("mechanisms attribute must be an array but "+ca(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!(0<=D(Oe,c.mechanisms[e])))throw new K('Invalid mechanism "'+c.mechanisms[e]+'"');}this.m=c.mechanisms||(Md||Ac()||E("iPad")||
E("iPod")?Ua(Oe,1):Oe);this.C=c.size;this.v=r(c.connectionTimeout)?c.connectionTimeout:3E3;this.a=null;this.f=[];this.va=!1;var f;if(b instanceof Ce)f=b;else if(A(b))for(c.autoSchema||!r(b.stores)?f=new Ge(b):f=new Ce(b),c=b.stores?b.stores.length:0,e=0;e<c;e++)d=S(f,b.stores[e].name),b.stores[e].Sync&&md(this.logger,"Synchronization option for "+d.getName()+" ignored.");else f=new Ge;this.c=f;for(e=0;e<this.c.count();e++)if(this.c.qb(e).i)throw Error("encryption option must be defined");r(a)&&this.l(a);
this.i=null;this.g=new F}T.prototype.logger=H("ydn.db.con.Storage");T.prototype.w=function(a){if(r(a)){var b=function(b){a(b.toJSON());a=void 0};if(this.a)Pe(this.a,b);else{var c=this;this.Y(function(a){Pe(c.a,b,a)},null,L)}}return this.c?this.c.toJSON():null};T.prototype.l=function(a){if(this.a)throw new qd("Already connected with "+this.h);this.h=a;Qe(this)};T.prototype.getName=function(){return this.h};var Oe="indexeddb sqlite websql localstorage sessionstorage userdata memory".split(" ");k=T.prototype;
k.Ea=function(){return null};
function Qe(a){function b(b,e){b?(I(a.logger,a+": ready."),a.Ua=NaN,d.Ma=function(b){a.B(new Td(a,b))},d.Ya=function(b){a.B(new Ud(a,b));a.a=null},d.Wa=function(b){a.B(b)},setTimeout(function(){Re(a,e);Se(a)},10),c.callback(e)):(md(a.logger,a+": database connection fail "+e.name),setTimeout(function(){Re(a,new Ud(a,e));if(a.f){var b=a.logger;for(b&&b.log($c,"Purging "+a.f.length+" transactions request.",void 0);b=a.f.shift();)b.D&&b.D("error",e)}},10),c.o(e))}for(var c=new F,d=null,e=a.m,f=0;f<e.length;f++){var g=
e[f].toLowerCase();if(d=a.Ea(g)){d=a.Ea(g);break}}null===d?(e=new Le("No storage mechanism found."),b(!1,new Ud(a,e))):Kb(d.connect(a.h,a.c),function(a){this.a=d;b(!0,new Sd("ready",this,parseFloat(d.s?parseFloat(d.s.version):void 0),parseFloat(a),null))},function(a){md(this.logger,this+": opening fail");b(!1,a)},a)}k.ma=function(){if(this.a)return"indexeddb"};k.xa=function(a,b){var c=this.g,d=new F;c.Ca(d);d.Pa(a,b)};
function Re(a,b){setTimeout(function(){a.c.wa&&a.g.c||(b instanceof Td?a.g.o(b.error):a.g.callback(),a.B(b))},4)}function Te(a){return!!a.a&&!!a.a.s}k.close=function(){this.a&&(this.a.close(),this.a=null,I(this.logger,this+" closed"))};k.Db=function(){return this.a?this.a.s||null:null};k.Ua=NaN;function Se(a){var b=a.f.shift();b&&(I(a.logger,"pop tx queue["+(a.f.length+1)+"]"),a.Y(b.ta,b.ob,b.mode,b.D));a.Ua=ja()}
function Ue(a,b,c,d,e){I(a.logger,"push tx queue["+a.f.length+"]");a.f.push({ta:b,ob:c,mode:d||L,D:e});100<a.f.length&&0==a.f.length%100&&md(a.logger,"Transaction queue stack size is "+a.f.length+". It is too large, possibility due to incorrect usage.")}k.va=!1;
k.Y=function(a,b,c,d){var e=b;if(x(b))e=[b];else if(null!=b)if(w(b)){if(0==b.length)throw new K("number of store names must more than 0");for(var f=0;f<b.length;f++)if(!x(b[f]))throw new K("store name at "+f+" must be string but found "+typeof b[f]);}else throw new K("store names must be an array");else e=null;if(this.a&&this.a.s&&!this.va){var g=this,h=r(c)?c:L;h==vd&&(this.va=!0);Ve(this.a,function(b){a(b);a=null},e,h,function(a,b){z(d)&&(d(a,b),d=void 0);h==vd&&(g.va=!1);Se(g)})}else Ue(this,a,
e,c,d)};k.B=function(){};k.toString=function(){return"Storage:"+this.a};T.prototype.close=T.prototype.close;T.prototype.getType=T.prototype.ma;T.prototype.getName=T.prototype.getName;T.prototype.getSchema=T.prototype.w;T.prototype.onReady=T.prototype.xa;T.prototype.setName=T.prototype.l;T.prototype.transaction=T.prototype.Y;T.prototype.db=T.prototype.Db;ka("ydn.db.version","1.4.3");ka("ydn.db.cmp",Kd);ka("ydn.db.deleteDatabase",function(a,b){for(var c,d=0;d<Ld.length;d++){var e=Ld[d](a,b);e&&(c=e)}return c||Id("IDBVersionChangeEvent ",null)});Sd.prototype.name=Sd.prototype.name;
Sd.prototype.getVersion=Sd.prototype.Gb;Sd.prototype.getOldVersion=Sd.prototype.jb;Sd.prototype.getOldSchema=Sd.prototype.ib;Td.prototype.getError=Td.prototype.f;Dd.prototype.abort=Dd.prototype.abort;Dd.prototype.canAbort=Dd.prototype.gb;sd.prototype.progress=sd.prototype.Qa;sd.prototype.promise=sd.prototype.sb;ka("ydn.db.KeyRange",R);R.only=be;R.bound=ce;R.upperBound=de;R.lowerBound=ee;function We(a,b,c){Nd.call(this);this.eb=c;this.Oa=c.getName();this.h=void 0;this.j=!1;this.Ja=null;this.f=a;this.$=b;this.N=0;this.i=this.g=!1;this.C=this.c=this.a=void 0;this.l=function(){throw new rd;};this.w=function(){throw new rd;};this.S=function(){}}C(We,Nd);
function Xe(a,b,c,d,e){if(r(b)){var f=a.eb,g,h=b;if(v(b)){a:{for(g=0;g<f.a.length;g++)if(!me(f.a[g].keyPath,b)){g=f.a[g];break a}g=null}h=b.join(", ")}else g=re(f,b);if(!g)throw new K('require index "'+h+'" not found in store "'+f.getName()+'"');a.h=g.getName()}a.j=x(a.h);a.Ja=c||null;a.N=0;a.g=!1;a.i=!1;a.reverse="prev"==d||"prevunique"==d;a.unique="nextunique"==d||"prevunique"==d;a.dir=d;a.Ia=e;a.a=void 0;a.c=void 0;a.C=void 0}k=We.prototype;k.dir="";k.Ja=null;k.unique=!1;k.reverse=!1;k.Ia=!0;
k.logger=H("ydn.db.core.req.AbstractCursor");function Ye(a,b,c,d){null==b&&(J(a.logger,a+" finished."),a.g=!0);a.a=b;a.c=c;a.C=d;a.N++;a.g?(I(a.logger,a+" DONE."),a.l(),Ze(a)):(I(a.logger,a+" new cursor position {"+(a.j?a.a+", "+a.c:a.a)+"}"),a.l(a.a))}k.L=function(){this.f=null};k.toString=function(){return"Cursor:"+this.Oa+(r(this.h)?":"+this.h:"")+"["+(this.f?"":"~")+this.$+"]"};function Ze(a){null!=a.c?a.c=Yd(a.c):a.c=void 0;null!=a.a?a.a=Yd(a.a):a.a=void 0;a.S(a.i,a.a,a.c)}
k.open=function(a,b,c,d){this.f=a;this.$=b;this.g=this.i=!1;this.a=c;this.c=d;this.openCursor(this.a,this.c)};function $e(a){a.i=!0;I(a.logger,a+": exit");Ze(a)}k.Ta=function(){return this.N};k.Fb=function(){return this.a};k.na=function(){return this.j?this.c:this.a};k.Na=function(){return this.Ia?this.na():this.C};k.Da=function(){};k.aa=function(){};function af(a,b,c){I(a.logger,a+" restarting");a.g=!1;a.i=!1;a.openCursor(c,b)};function bf(){};function U(a,b,c,d,e,f,g){if(!x(a))throw new TypeError("store name must be a string, but "+a+" found.");this.b=a;this.c=b;this.g=g;this.m=!!this.c;if(r(d)&&!da(d))throw new K("reverse value must be a boolean, but "+typeof d+" found");if(r(e)&&!da(e))throw new K("unique value must be a boolean, but "+typeof e+" found");if(r(f)&&!da(f))throw new K("key_only value must be a boolean, but "+typeof f+" found");this.f=r(f)?f:!!x(this.c);a="next";d&&e?a="prevunique":d?a="prev":e&&(a="nextunique");this.i=
a;if(d=he(c))throw new K("Invalid key range: "+d);this.a=ae(c);this.h=cf;this.v=NaN}C(U,bf);U.prototype.f=!0;function df(a,b,c){if(3<arguments.length)throw new K("too many argument");U.call(this,a,void 0,b,c,void 0,!0)}C(df,U);function ef(a,b,c,d,e){if(!x(b))throw new K("index name must be string");U.call(this,a,b,c,d,e,!0)}C(ef,U);function ff(a,b,c){if(3<arguments.length)throw new K("too many argument");U.call(this,a,void 0,b,c,void 0,!1)}C(ff,U);
function gf(a,b,c,d,e){if(!x(b))throw new K("index name must be string");U.call(this,a,b,c,d,e,!1)}C(gf,U);var cf="init";k=U.prototype;k.logger=H("ydn.db.Iterator");k.xb=function(){return this.b};k.tb=function(){return this.c};k.vb=function(){return this.a?this.a instanceof ge?this.a:ge.bound(this.a.lower,this.a.upper,this.a.lowerOpen,this.a.upperOpen):null};k.yb=function(){return this.f};k.lb=function(){return this.m};
k.clone=function(){var a=new U(this.b,this.c,this.a,this.P(),this.za(),this.f,this.g);a.v=this.v;return a};k.unique=function(a){return new U(this.b,this.c,this.a,this.P(),a,this.f,this.g)};k.toJSON=function(){return{store:this.b,index:this.c,keyRange:this.a?Zd(this.a):null,direction:this.i}};
k.toString=function(){var a=r(this.g)?":"+this.g.join(","):r(this.c)?":"+this.c:"",b;if(b=this.a){var c=b.lowerOpen?"(":"[";null!=b.lower&&(c+=b.lower+", ");null!=b.upper&&(c+=b.upper);b=c+=b.upperOpen?")":"]"}else b="";a+=b;this.h!=cf&&(a+=this.h+"{"+this.j,this.m&&(a+=", "+this.l),a+="}");b=this.m?"Index":"";b+=this.f?"Key":"Value";return b+"Iterator:"+this.b+a};k.zb=function(a,b){var c=new U(this.b,this.c,this.a,this.P(),this.za(),this.f,this.g);c.j=a;c.l=b;c.h="rest";return c};
k.reverse=function(){return new U(this.b,this.c,this.a,!this.P(),this.za(),this.f,this.g)};k.P=function(){return"prev"===this.i||"prevunique"===this.i};k.za=function(){return"nextunique"===this.i||"prevunique"===this.i};k.kb=function(){return this.h};k.load=function(a){a=a[0];Xe(a,this.g||this.c,this.a,this.i,this.f);this.h="busy";var b=this;a.S=function(a,d,e){b.j=d;b.l=e;b.h=a?"rest":"done"};a.openCursor(this.j,this.l);return a};k.ub=function(){return this.j};k.wb=function(){return this.l};
k.reset=function(a,b,c){a=a||cf;"busy"==this.h?md(this.logger,this+": resetting state to "+a+" ignore during iteration"):(this.j=b,this.l=c,this.h=a)};k.stores=function(){return[this.b]};function hf(a,b,c,d){if("transaction"in a)this.i=a,this.c=this.h=null;else if("objectStore"in a){if(this.i=null,this.h=a.db,this.c=a,!this.c.db.objectStoreNames.contains(b))throw new Ie('store "'+b+'" not in transaction.');}else throw new Ie("storage instance require.");this.j=b;this.l=c;this.m=d;this.b=[];this.a=0;this.g=!1}hf.prototype.logger=H("ydn.db.con.IdbCursorStream");hf.prototype.g=!1;
function jf(a,b){a.a++;b.onsuccess=function(b){if(b=b.target.result){if(z(a.m)){var d=b.value;a.m(b.primaryKey,null!=a.l?d[a.l]:d)}else md(a.logger,"sink gone, dropping value for: "+b.primaryKey);if(b&&0<a.b.length)b["continue"](a.b.shift());else a.a--,0==a.a&&a.K&&a.K()}};b.onerror=function(){md(a.logger,"seeking fail. "+("error"in b?b.error.name+":"+b.error.message:""));a.a--;0==a.a&&a.K&&a.K()}}function kf(a,b){0==a.b.length&&0==a.a?b():a.K=b}
function lf(a){if(!a.g){var b=function(b,c){a.c=null;"complete"!==b&&md(a.logger,c.name+":"+c.message);I(a.logger,a+" transaction "+b)},c=function(b){var c=a.b.shift();I(a.logger,a+" transaction started for "+c);b=b.objectStore(a.j);jf(a,b.openCursor(c))};if(a.c)I(a.logger,a+" using existing tx."),c(a.c);else if(a.h)I(a.logger,a+" creating tx from IDBDatabase."),a.f=a.h.transaction([a.j],L),a.f.oncomplete=function(a){b("complete",a)},a.f.onerror=function(a){b("error",a)},a.f.onabort=function(a){b("abort",
a)};else if(a.i)I(a.logger,a+" creating tx from ydn.db.con.IStorage."),a.g=!0,a.i.Y(function(b){a.g=!1;c(b)},[a.j],L,b);else throw new Ke("no way to create a transaction provided.");}};function mf(a,b,c){a&&a instanceof T?this.ka=a:a&&a.db&&(this.ka=null,nf(this,a));if(!x(b))throw new K("a store name required.");this.c=b;if(r(c)&&!x(c))throw new K("projection index name must be a string.");this.la=c;this.T=null;this.b=[];this.a=[];this.ca=!1}k=mf.prototype;k.logger=H("ydn.db.Streamer");k.ka=null;k.La=null;k.T=null;k.pb=function(a){this.La=a};function nf(a,b){if(b.db)a.T=new hf(b,a.c,a.la,B(a.K,a));else throw new K("Invalid IndexedDB Transaction.");}
function of(a){var b=0<a.a.length;if(b&&!a.ca&&z(a.La)){var c=function(){of(a)},d=a.b.shift(),e=a.a.shift(),b=0<a.a.length,c=a.La(d,e,b?c:null);b&&!c&&of(a)}}k.ca=!1;k.Cb=function(a){if(this.T){this.ca=!0;var b=this;kf(this.T,function(){a(b.b,b.a);b.b=[];b.a=[];b.ca=!1})}else a(this.b,this.a),this.b=[],this.a=[]};k.K=function(a,b){this.b.push(a);this.a.push(b);of(this)};
k.push=function(a,b){if(this.ca)throw new Ne("push not allowed after a collection is started");if(2<=arguments.length)this.K(a,b);else{if(!this.T){if(!this.ka)throw new Ne("Database connection is not setup.");var c=this.ka.ma();if(c)if("indexeddb"===c)this.T=new hf(this.ka,this.c,this.la,B(this.K,this));else throw new Je(c);else throw new Ne("Database is not connected.");}c=this.T;c.b.push(a);lf(c)}};k.toString=function(){return"Streamer:"+this.c+(this.la||"")};function pf(a,b){if(null!=a&&!("push"in a))throw new Ie('output receiver object must have "push" method.');this.a=a||null;this.c=b;this.h=0;this.b=!1;this.g=a instanceof mf&&!!a.la}pf.prototype.logger=H("ydn.db.algo.AbstractSolver");
pf.prototype.i=function(a,b){this.b=b[0].P();for(var c=0;c<b.length;c++){if(!(b[c]instanceof U))throw new od("item at iterators "+c+" is not an iterator.");if(0<c&&this.b!=b[c].P())throw new od("iterator at "+c+" must "+(this.b?"be reverse":"not be reverse"));}this.a instanceof mf&&nf(this.a,a);if(this.g&&(c=b[0].g)&&1<c.length&&c[c.length-1]!=this.a.la)throw new Ne("Output streamer projection field must be same as postfix field in the iterator");for(var d="{",c=0;c<b.length;c++)0<c&&(d+=", "),d+=
b.toString();d+="}";this.b&&(d+=" reverse");nd(this.logger,this+" begin "+d);return!1};function qf(a,b,c){var d,e=null!=d;if(!r(d)){d=c[0];for(var e=null!=d,f=1;e&&f<c.length;f++)null!=c[f]&&0==Kd(c[f],d)||(e=!1)}return e&&(a.h++,a.a&&(a.g?a.a.push(d,void 0):a.a.push(d)),r(a.c)&&a.h>=a.c)?[]:b}pf.prototype.f=function(){return[]};function Gd(a){Error.captureStackTrace?Error.captureStackTrace(this,Gd):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"}C(Gd,Error);function rf(a){Error.captureStackTrace?Error.captureStackTrace(this,rf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"}C(rf,Error);function sf(a){Error.captureStackTrace?Error.captureStackTrace(this,sf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"}
C(sf,Error);sf.prototype.name="NotFoundError";sf.prototype.toString=function(){return this.name+": "+this.message};function tf(a){Error.captureStackTrace?Error.captureStackTrace(this,tf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"}C(tf,Error);function uf(a,b){this.a=b}uf.prototype.logger=H("ydn.db.crud.req.RequestExecuto");uf.prototype.toString=function(){return"RequestExecutor"};function vf(a){this.c=a;this.a=null;this.b=0}vf.prototype.logger=H("ydn.db.tr.Mutex");vf.prototype.F=null;function wf(a){return!!a.a&&!a.f}vf.prototype.D=null;vf.prototype.toString=function(){return"Mutex:"+("B"+this.c+"T"+this.b)+(this.a?"*":"")};function xf(a,b,c,d,e,f){this.j=a;this.N=b;this.a=this.f=0;this.C=d;this.w=e;this.g=c||yf;this.l=f||0}xf.prototype.logger=H("ydn.db.tr.Thread");xf.prototype.type=function(){return this.j.ma()};xf.prototype.A=function(){return"B"+this.N+"T"+this.f};var yf="single";function zf(a){if(a)if(z(a.abort))a.abort();else if(z(a.executeSql))a.executeSql("ABORT",[],null,function(){return!0});else throw new pd;else throw new Gd("No active transaction");};function Af(a,b,c,d,e,f){xf.call(this,a,b,c,d,e,f);this.c=[];this.h=[];this.i=null;this.b=new vf(b);this.m=f||0;this.v=!1}C(Af,xf);k=Af.prototype;k.logger=H("ydn.db.tr.Serial");
function Bf(a,b,c){if("multi"==a.g)a:if(a=a.b,!a.F||!a.mode||c!=a.mode&&(a.mode!=M||c!=L)||b.length>a.F.length)b=!1;else{for(c=0;c<b.length;c++)if(-1==a.F.indexOf(b[c])){b=!1;break a}b=!0}else if("repeat"==a.g)a:if(a=a.b,a.F&&a.mode&&c==a.mode&&a.F.length==b.length){for(c=0;c<b.length;c++)if(-1==a.F.indexOf(b[c])){b=!1;break a}b=!0}else b=!1;else b="all"==a.g?!0:!1;return b}function Cf(a){var b=0<a.c.length?a.c[0].F:null,c=0<a.c.length?a.c[0].mode:null;return null!=b&&null!=c?Bf(a,b,c):!1}
function Df(a,b,c,d,e){I(a.logger,"push tx queue["+a.c.length+"]");a.c.push({ta:b,F:c,mode:d||L,D:e})}k.abort=function(){J(this.logger,this+": aborting");zf(this.i)};
k.R=function(a,b,c,d){var e=x(b)?[b]:b;if(w(e)){if(0==e.length)throw new K("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!x(e[f]))throw new K("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.S&&!(0<=D(this.S,e[f])))throw new K('store name "'+f+e[f]+'" in scope of '+this);}}else throw new K("store names must be an array");var g=r(c)?c:L,h=this;if(this.b.a||!Te(this.j)&&this.v)Df(this,a,b,g,d);else{var l=this.A();d&&this.h.push(d);if(this.m&&
this.f>=this.m)throw new qd("Exceed maximum number of transactions of "+this.m);this.v=!0;this.j.Y(function(c){var d=h.b;d.a=c;d.f=!1;d.F=b;d.mode=g;d.b++;d.D=null;l=h.A();nd(h.logger,l+" BEGIN "+qe(b)+" "+g);a(h);for(a=null;Cf(h);)c=h.c.shift(),c.D&&h.h.push(c.D),I(h.logger,"pop tx queue"+(h.c.length+1)+" reusing T"+h.f),c.ta()},e,g,function(a,b){nd(h.logger,l+" "+a);var c=h.b;c.a?(c.a=null,c.F=null,c.mode=null,z(c.D)&&c.D(a,b),c.D=null):md(c.logger,c+" has no TX to be unlocked for "+a);for(c=0;c<
h.h.length;c++)(0,h.h[c])(a,b);h.h.length=0;(c=h.c.shift())&&h.R(c.ta,c.F,c.mode,c.D);h.a=0})}};k.A=function(){var a=this.b;return"B"+a.c+"T"+a.b};k.request=function(a,b,c,d){function e(a,b){Fd(f);d&&d(a,b)}var f=new Dd(a);a=c||L;var g=this;wf(this.b)&&Bf(this,b,a)?(b=this.b.a,this.a++,Ed(f,b,this.A()+"R"+this.a),this.h.push(e)):g.R(function(){var a=g.b.a;g.a++;Ed(f,a,g.A()+"R"+g.a)},b,a,e);return f};
k.Z=function(a,b,c,d,e){d=d||L;var f=this,g;if(wf(f.b)&&Bf(this,c,d)){var h=f.b.a;f.a++;g=f.A()+"R"+f.a;J(f.logger,g+" BEGIN");b(h,g,function(b,c){f.i=h;c?(J(f.logger,g+" ERROR"),a.o(b)):(J(f.logger,g+" SUCCESS"),a.callback(b));f.i=null});J(f.logger,g+" END");b=null}else f.R(function(){var c=f.b.a;f.a++;g=f.A()+"R"+f.a;J(f.logger,g+" BEGIN");b(c,g,function(b,d){f.i=c;d?(J(f.logger,g+" ERROR"),a.o(b)):(J(f.logger,g+" SUCCESS"),a.callback(b));f.i=null});J(f.logger,g+" END");b=null},c,d,e)};
k.getName=function(){return this.j.getName()};k.toString=function(){return"Serial:"+this.A()+(this.i?"*":"")};function Ef(a,b){Af.call(this,a,b)}C(Ef,Af);Ef.prototype.logger=H("ydn.db.tr.AtomicSerial");Ef.prototype.request=function(a,b,c){var d,e,f,g=Ef.u.request.call(this,a,b,c,function(a,b){Fd(g);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new tf;N(g,c,!0)}});Hd(g,function(a,b,c){f=b;e=a;d=c});return g};
Ef.prototype.Z=function(a,b,c,d,e){var f,g,h=new F;Kb(h,function(a){g=!1;f=a},function(a){g=!0;f=a});Ef.u.Z.call(this,h,b,c,d,function(b,c){if("complete"!=b)a.o(c);else if(!0===g)a.o(f);else if(!1===g)a.callback(f);else{var d=new tf;a.o(d)}e&&(e(b,c),e=void 0)})};Ef.prototype.toString=function(){return"Atomic"+Ef.u.toString.call(this)};function Ff(a,b,c){this.c=a;this.b=b;this.a=c;this.f=null}Ff.prototype.logger=H("ydn.db.tr.DbOperator");Ff.prototype.g=function(){return this.a.f};Ff.prototype.abort=function(){this.a.abort()};function V(a){if(!a.f){var b;b=a.c;var c=b.ma();if("indexeddb"==c)b=new Gf(0,b.c);else throw new rd("No executor for "+c);a.f=b}return a.f}
function Hf(a,b){var c=x(b)?b:A(b)?b.name:void 0;if(!x(c))throw new K("store name "+c+" must be a string, but "+typeof c);var d=S(a.b,c);if(!d){if(!a.b.J())throw new K('store name "'+c+'" not found.');d=pe(A(b)?b:{name:c});J(a.logger,"Adding object store: "+c);var e=a.c,f=d,g=f instanceof oe?f:pe(f),f=f.name,h=S(e.c,f);if(0==ve(g,h).length)(new F).callback(!1);else if(h=h?"update":"add",e.c instanceof Ge)He(e.c,g),e.a?(e.a.close(),e.a=null,Qe(e)):(new F).callback(!1);else throw new Le("Cannot "+h+
" store: "+f+". Not auto schema generation mode.");}else if(a.b.J()&&A(b)&&(e=pe(b),e=ve(d,e)))throw new pd(e);if(!d)throw new sf(c);return d}Ff.prototype.toString=function(){return"TxStorage:"+this.c.getName()};function X(a,b,c){Ff.call(this,a,b,c)}C(X,Ff);k=X.prototype;k.logger=H("ydn.db.crud.DbOperator");
k.count=function(a,b,c,d){var e,f,g,h;if(null!=a)if(v(a)){if(r(c)||r(b))throw new K("too many arguments.");f=a;for(var l=0;l<f.length;l++)if(!Ee(this.b,f[l]))throw new K('store name "'+f[l]+'" at '+l+" not found.");J(this.logger,"countStores: "+qe(f));e=this.a.request("count",f);O(e,function(){If(V(this),e,f)},this)}else if(x(a)){l=S(this.b,a);if(!l)throw new K('store name "'+a+'" not found.');if(r(d)&&!da(d))throw new K('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(x(b))if(g=
b,A(c)){var p=he(c);if(p)throw new K("invalid key range: "+ye(c)+" "+p);h=ae(c)}else{if(null!=c)throw new K("invalid key range: "+ye(c)+" of type "+typeof c);h=null}else if(A(b)||null==b)if(A(b)){if(p=he(b))throw new K("invalid key range: "+ye(b)+" "+p);h=ae(b)}else{if(null!=b)throw new K("key range must be  an object but found "+ye(b)+" of type "+typeof b);h=null}else throw new K('invalid second argument for count "'+ye(c)+'" of type '+typeof b);J(this.logger,"countKeyRange: "+a+" "+(g?g:"")+qe(h));
e=this.a.request("count",f);xe(l,e,arguments);O(e,function(){Jf(V(this),e,f[0],h,g,!!d)},this)}else throw new K("Invalid store name or store names.");else md(this.logger,"count method requires store name(s)"),l=De(this.b),e=this.a.request("count",l),Hd(e,function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),O(e,function(){If(V(this),e,f)},this);return e};
k.get=function(a,b){var c=this,d;if(a instanceof Xd){var e=a,f=e.a,g=S(this.b,f);if(!g){if(this.b.J()){if(Te(this.c))return Id("get",void 0);d=new Dd("get");this.c.xa(function(){Kb(c.get(a,b),function(a){d.callback(a)},function(a){d.o(a)})});return d}throw new K("Store: "+f+" not found.");}var h=e.id;J(this.logger,"getByKey: "+f+":"+h);d=this.a.request("get:key",[f]);xe(g,d,arguments,void 0,this);O(d,function(){Kf(V(this),d,f,h)},this)}else if(x(a)&&r(b)){var l=a,g=S(this.b,l);if(!g){if(this.b.J()){if(Te(this.c))return Id("get",
void 0);d=new Dd("get");this.c.xa(function(){Kb(c.get(a,b),function(a){d.callback(a)},function(a){d.o(a)})});return d}throw new K('Store name "'+l+'" not found.');}var p=b;J(this.logger,"getById: "+l+":"+p);d=this.a.request("get",[l]);xe(g,d,arguments,void 0,this);O(d,function(){Kf(V(this),d,l,p)},this)}else throw new K("get require valid input arguments.");return d};
k.mb=function(a,b,c,d,e){var f=S(this.b,a),g,h,l,p=null;if(A(b)){var t=he(b);if(t)throw new K("invalid key range: "+b+" "+t);p=ae(b)}else if(null!=b)throw new K('expect key range object, but found "'+ye(b)+'" of type '+typeof b);if(r(c))if(y(c))g=c;else throw new K("limit must be a number, but "+c+" is "+typeof c);else g=100;if(r(d))if(y(d))h=d;else throw new K("offset must be a number, but "+d+" is "+typeof d);else h=0;if(r(e))if(da(e))l=e;else throw new K("reverse must be a boolean, but "+e+" is "+
typeof e);J(this.logger,"keysByKeyRange: "+a);var m=this.a.request("keys",[a]);xe(f,m,arguments);O(m,function(){Lf(V(this),m,2,a,null,p,g,h,l,!1)},this);return m};
k.da=function(a,b,c,d,e,f,g){var h,l,p,t,m,q=he(c);if(q)throw new K("invalid key range: "+c+" "+q);q=S(this.b,a);h=ae(c);if(y(d))l=d;else{if(r(d))throw new K("limit must be a number");l=100}if(y(e))p=e;else{if(r(e))throw new K("offset must be a number");p=0}if(r(f))if(da(f))t=f;else throw new K("reverse must be a boolean");if(r(g))if(da(g))m=g;else throw new K("unique must be a boolean");J(this.logger,"keysByIndex: "+a);var u=this.a.request("keys:iter:index",[a]);xe(q,u,arguments);O(u,function(){Lf(V(this),
u,2,a,b,h,l,p,t,m)},this);return u};k.keys=function(a,b,c,d,e,f,g){var h=S(this.b,a);if(!x(a))throw new K("store name must be a string, but "+a+" of type "+typeof a+" is not.");if(!this.b.J()){if(!h)throw new K('store name "'+a+'" not found.');if(x(b)&&!re(h,b))throw new K('index "'+b+'" not found in store "'+a+'".');}return this.b.J()&&!h?Id("keys",[]):x(b)?this.da(a,b,c,d,e,f,g):this.mb(a,b,c,d,e)};
k.values=function(a,b,c,d,e,f,g){var h=this,l;if(x(a)){var p=a,t=S(this.b,p);if(!t){if(this.b.J()){if(Te(this.c))return Id("values",[]);l=new Dd("values");this.c.xa(function(){Kb(h.values(a,b,c,d,e,f),function(a){l.callback(a)},function(a){l.o(a)})});return l}throw new sf(p);}if(v(b)){if(r(c)||r(d))throw new K("too many input arguments");var m=b;J(this.logger,"listByIds: "+p+" "+m.length+" ids");l=this.a.request("values:array",[p]);xe(t,l,arguments,void 0,this);O(l,function(){Mf(V(this),l,p,m)},this)}else l=
x(b)?this.ia(p,b,c,d,e,f,g):this.rb(p,b,c,d,e)}else if(v(a))if(a[0]instanceof Xd){for(var t=[],q=a,u=0;u<q.length;u++){var G=q[u].a;if(!Ee(this.b,G)){if(this.b.J())return t=[],t[q.length-1]=void 0,Id("get",t);throw new K("Store: "+G+" not found.");}0<=D(t,G)||t.push(G)}J(this.logger,"listByKeys: "+qe(t)+" "+q.length+" keys");l=this.a.request("values:keys",t);O(l,function(){Nf(V(this),l,q)},this)}else throw new K("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found.");
else throw new K("first argument "+a+" is invalid.");return l};
k.rb=function(a,b,c,d,e){var f=S(this.b,a),g,h,l,p=null;if(A(b)){var t=he(b);if(t)throw new K("invalid key range: "+b+" "+t);p=ae(b)}else if(null!=b)throw new K('expect key range object, but found "'+ye(b)+'" of type '+typeof b);if(r(c))if(y(c))g=c;else throw new K("limit must be a number, but "+c+" is "+typeof c);else g=100;if(r(d))if(y(d))h=d;else throw new K("offset must be a number, but "+d+" is "+typeof d);else h=0;if(r(e))if(da(e))l=e;else throw new K("reverse must be a boolean, but "+e+" is "+
typeof e);J(this.logger,(p?"listByKeyRange: ":"listByStore: ")+a);var m=this.a.request("values",[a]);xe(f,m,arguments);O(m,function(){Lf(V(this),m,4,a,null,p,g,h,l,!1)},this);return m};
k.ia=function(a,b,c,d,e,f,g){var h=S(this.b,a),l,p,t,m;if(!se(h,b))throw new K('index "'+b+'" not found in store "'+a+'"');var q=he(c);if(q)throw new K("invalid key range: "+c+" "+q);var u=ae(c);if(r(d))if(y(d))l=d;else throw new K("limit must be a number.");else l=100;if(r(e))if(y(e))p=e;else throw new K("offset must be a number.");else p=0;if(da(f))t=f;else if(r(f))throw new K("reverse must be a boolean, but "+f);if(r(g))if(da(g))m=g;else throw new K("unique must be a boolean");J(this.logger,"listByIndexKeyRange: "+
a+":"+b);var G=this.a.request("values:iter:index",[a]);xe(h,G,arguments);O(G,function(){Lf(V(this),G,4,a,b,u,l,p,t,m)},this);return G};
k.add=function(a,b,c){if(v(b))return this.oa(a,b,c);var d=Hf(this,a),e=d.getName(),f;if(x(d.keyPath)&&r(c))throw new K("key must not be provided while the store uses in-line key.");if(!d.keyPath&&!d.b&&!r(c))throw new K("out-of-line key must be provided for store: "+e);if(v(b)){J(this.logger,"addObjects: "+e+" "+b.length+" objects");for(a=0;a<b.length;a++)we(d,b[a]);f=this.a.request("add:array",[e],M);O(f,function(){Of(V(this),f,!1,!1,e,b,c)},this);d.H&&f.G(function(a){this.c.B(new Wd("created",this.c,
e,a,b))},this)}else if(A(b))a="store: "+e+" key: "+te(d,b,c),J(this.logger,"addObject: "+a),we(d,b),f=this.a.request("add",[e],M),O(f,function(){Of(V(this),f,!1,!0,e,[b],[c])},this),d.H&&f.G(function(a){this.c.B(new Vd("created",this.c,d.getName(),a,b))},this);else throw new K("record must be an object or array list of objects, but "+b+" of type "+typeof b+" found.");return f};
k.oa=function(a,b,c){var d=Hf(this,a),e=d.getName(),f;if(x(d.keyPath)&&r(c))throw new K("key must not be provided while the store uses in-line key.");if(!d.keyPath&&!d.b&&!r(c))throw new K("out-of-line key must be provided for store: "+e);if(v(b)){J(this.logger,"addObjects: "+e+" "+b.length+" objects");for(a=0;a<b.length;a++)we(d,b[a]);f=this.a.request("add:array",[e],M);O(f,function(){Of(V(this),f,!1,!1,e,b,c)},this);d.H&&f.G(function(a){this.c.B(new Wd("created",this.c,d.getName(),a,b))},this)}else throw new K("record must be an array list of objects, but "+
b+" of type "+typeof b+" found.");return f};
k.put=function(a,b,c){var d,e=this;if(a instanceof Xd){var f=a,g=f.a,h=S(this.b,g);if(!h)throw new K('store "'+g+'" not found.');if(h.keyPath){var l=te(h,b);if(null!=l){if(0!=Kd(l,f.id))throw new K("Inline key must be "+f+" but "+l+" found.");}else ue(h,b,f.id);return this.put(g,b)}return this.put(g,b,f.id)}if(v(a)){if(r(c))throw new K("too many arguments");var p=a;if(!r(b))throw new K("record values required");for(var t=b,f=[],g=0,h=p.length;g<h;g++){l=p[g].a;-1==D(f,l)&&f.push(l);var m=S(this.b,
l);if(!m)throw new K('store "'+l+'" not found.');m.keyPath&&ue(m,t[g],p[g].id)}J(this.logger,"putByKeys: to "+qe(f)+" "+t.length+" objects");for(g=0;g<t.length;g++)we(m,t[g]);d=this.a.request("put:keys",f,M);xe(m,d,arguments);O(d,function(){Pf(V(e),d,t,p)},this)}else if(x(a)||A(a)){var m=Hf(this,a),q=m.getName();if(m.keyPath&&r(c))throw new K("key must not be provided while the store uses in-line key.");if(!m.keyPath&&!m.b&&!r(c))throw new K("out-of-line key must be provided for store: "+q);if(v(b)){var u=
b,G=c;J(this.logger,"putObjects: "+q+" "+u.length+" objects");for(g=0;g<u.length;g++)we(m,u[g]);d=this.a.request("put:array",[q],M);xe(m,d,arguments);O(d,function(){Of(V(this),d,!0,!1,q,u,G)},this);m.H&&d.G(function(a){this.c.B(new Wd("updated",this.c,q,a,u))},this)}else if(A(b)){var P=b,W=c;J(this.logger,"putObject: "+q+" "+(r(W)?W:"(without-key)"));if(r(n.Blob)&&P instanceof Blob&&m.ab&&!m.keyPath&&0==m.a.length&&Fc)d=new Dd("put"),f=new FileReader,f.onload=function(a){var b=a.target.result,c=e.a.request("put",
[q],M);xe(m,c,[q,P,W]);O(c,function(){Of(V(e),c,!0,!0,q,[b],[W])},this);Kb(c,function(a){d.callback(a)},function(a){d.o(a)})},f.onerror=function(a){d.o(a)},f.onabort=function(a){d.o(a)},f.readAsDataURL(P);else{we(m,P);d=this.a.request("put",[q],M);var Sa=[q,P,W];xe(m,d,Sa);O(d,function(){var a=r(W)?[Sa[2]]:void 0;Of(V(e),d,!0,!0,q,[Sa[1]],a)},this)}m.H&&d.G(function(a){this.c.B(new Vd("updated",this.c,q,a,P))},this)}else throw new K("put record value must be Object or array of Objects");}else throw new K("the first argument of put must be store name, store schema or array of keys.");
return d};
k.ya=function(a,b,c){var d,e=Hf(this,a),f=e.getName();if(e.keyPath&&r(c))throw new K("key must not be provided while the store uses in-line key.");if(!e.keyPath&&!e.b&&!r(c))throw new K("out-of-line key must be provided for store: "+f);var g=b,h=c;J(this.logger,"putObjects: "+f+" "+g.length+" objects");for(var l=0;l<g.length;l++)we(e,g[l]);d=this.a.request("put:array",[f],M);xe(e,d,arguments);O(d,function(){Of(V(this),d,!0,!1,f,g,h)},this);e.H&&d.G(function(a){this.c.B(new Wd("updated",this.c,f,a,
g))},this);return d};
k.clear=function(a,b,c){if(r(c))throw new K("too many input arguments");var d;if(x(a)){c=S(this.b,a);if(!c)throw new K('store name "'+a+'" not found.');if(A(b)){var e=ae(b);if(null===e)throw new K("clear method requires a valid non-null KeyRange object.");J(this.logger,"clearByKeyRange: "+a+":"+qe(e));d=this.a.request("clear",[a],M);xe(c,d,[a,e]);O(d,function(){Qf(V(this),d,a,e)},this)}else{if(r(b))throw new K("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+
typeof b);J(this.logger,"clearByStore: "+a);d=this.a.request("clear",[a],M);O(d,function(){Rf(V(this),d,[a])},this)}}else if(!r(a)||v(a)&&x(a[0])){var f=a||De(this.b);J(this.logger,"clearByStores: "+qe(f));d=this.a.request("clear",f,M);O(d,function(){Rf(V(this),d,f)},this)}else throw new K('first argument "'+a+'" is invalid.');return d};
k.Aa=function(a,b,c){var d;if(x(a)){var e=S(this.b,a);if(!e)throw new K('store name "'+a+'" not found.');if(r(c))if(x(b)){var f=re(e,b);if(!f)throw new K("index: "+b+" not found in "+a);if(A(c)||null===c){var g=ae(c);J(this.logger,"removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.a.request("rm:iter:index",[a],M);O(d,function(){Sf(V(this),d,a,f.getName(),g)},this)}else throw new K("key range "+c+' is invalid type "'+typeof c+'".');}else throw new K('index name "'+b+'" must be a string, but '+
typeof b+" found.");else if(x(b)||y(b)||w(b)||b instanceof Date){J(this.logger,"removeById: "+a+":"+b);d=this.a.request("rm",[a],M);var h=[a,b];xe(e,d,h);O(d,function(){Tf(V(this),d,a,h[1])},this);e.H&&d.G(function(c){this.c.B(new Vd("deleted",this.c,a,1==c?b:void 0,void 0))},this)}else if(A(b))g=ae(b),J(this.logger,"removeByKeyRange: "+a+":"+qe(g)),d=this.a.request("rm:iter",[a],M),xe(e,d,[a,g]),O(d,function(){Uf(V(this),d,a,g)},this),e.H&&d.G(function(b){var c=[];c.length=b;this.c.B(new Wd("deleted",
this.c,a,c,void 0))},this);else throw new K('Invalid key or key range "'+b+'" of type '+typeof b);}else if(a instanceof Xd){var l=a.a,e=S(this.b,l);d=this.a.request("rm",[l],M);var p=[l,a.id];xe(e,d,p);O(d,function(){Tf(V(this),d,l,p[1])},this)}else if(v(a)){c=[];for(var e=0,t=a.length;e<t;e++){if(!(a[e]instanceof Xd))throw new K("key list element at "+e+" of "+t+' must be yn.db.Key, but "'+ye(a[e])+'" ('+ca(a[e])+") is not ydn.db.Key.");var m=a[e].a;-1==D(c,m)&&c.push(m)}if(1>c.length)throw new K('at least one valid key required in key list "'+
ye(a)+'"');d=this.a.request("rm:keys",c,M);O(d,function(){Vf(V(this),d,a)},this)}else throw new K('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+ye(a)+'" ('+ca(a)+") found.");return d};k.toString=function(){return"DbOperator:"+this.c.getName()};function Wf(a,b,c){Ff.call(this,a,b,c)}C(Wf,X);k=Wf.prototype;k.logger=H("ydn.db.core.DbOperator");k.get=function(a,b){if(a instanceof U){var c=a.b,d=S(this.b,c);if(!d)throw new K('store "'+c+'" not found.');var e=a.c;if(r(e)&&!se(d,e))throw new K('index "'+e+'" not found in store "'+c+'".');J(this.logger,"getByIterator:"+a);var f=this.a.request("get:iter",[c]);O(f,function(){Xf(this,5,f,a,1)},this);return f}return Wf.u.get.call(this,a,b)};
k.ea=function(a,b){var c=100;if(y(b)){if(c=b,1>c)throw new K("limit must be a positive value, but "+b);}else if(r(b))throw new K("limit must be a number,  but "+b);J(this.logger,"keysOf:"+a);var d=this.a.request("keys:iter",[a.b]);O(d,function(){a.m?Xf(this,1,d,a,c):Xf(this,2,d,a,c)},this);return d};k.keys=function(a,b,c,d,e,f,g){return a instanceof U?this.ea(a,b):Wf.u.keys.call(this,a,b,c,d,e,f,g)};
k.ba=function(a){J(this.logger,"countIterator:"+a);var b=this.a.request("count",[a.b]);O(b,function(){Xf(this,6,b,a)},this);return b};k.count=function(a,b,c,d){if(a instanceof U){if(r(b)||r(c))throw new K("too many arguments.");return this.ba(a)}return Wf.u.count.call(this,a,b,c,d)};
k.ja=function(a,b){var c;if(y(b)){if(c=b,1>c)throw new K("limit must be a positive value, but "+c);}else if(r(b))throw new K("limit must be a number, but "+b);J(this.logger,"listByIterator:"+a);var d=this.a.request("values:iter",[a.b]);O(d,function(){a.f?Xf(this,2,d,a,c):Xf(this,4,d,a,c)},this);return d};k.values=function(a,b,c,d,e,f){return a instanceof U?this.ja(a,b):Wf.u.values.call(this,a,b,c,d,e,f)};
k.Za=function(a,b,c){if(!v(b))throw new K("iterators argument must be an array, but "+b+" of type "+typeof b+" found");for(var d=0;d<b.length;d++)if(!(b[d]instanceof U))throw new K("Iterator at "+d+" must be cursor range iterator.");c=c||L;for(var e=[],d=0;d<b.length;d++)for(var f=b[d].stores(),g=0;g<f.length;g++)0<=D(e,f[g])||e.push(f[g]);J(this.logger,this+": scan for "+b.length+" iterators on "+e);var h=this,d=this.a.request("scan",e);this.a.Z(d,function(c,d,e){function f(){for(var a=0,e=0;e<b.length;e++){var t=
b[e],m=[Yf(V(h),c,d,t.b)],t=t.load(m);t.w=g;t.l=ia(u,a);La[e]=t;Sa[a]=e;a++}W=b.length}function g(a){for(var b=0;b<La.length;b++)$e(La[b]);Ra(La);J(h.logger,G+" error");e(a,!0)}function u(c,d){if(P)throw new Ke;Kc++;var f=Kc===W,g=Sa[c],l=b[g],p=La[g],g=p.na(),p=p.Na();Yb[c]=d;Jc[c]=l.m?l.f?g:p:l.f?d:p;if(f){var m;a instanceof pf?m=a.f(Yb,Jc):m=a(Yb,Jc);f=[];l=[];g=[];p=[];if(v(m))for(var q=0;q<m.length;q++)!0===m[q]?g[q]=1:!1===m[q]?p[q]=!0:l[q]=m[q];else if(null===m)f=[];else if(r(m))if(A(m)){f=
["advance","continue","continuePrimary","restart"];for(q in m)if(!(0<=D(f,q)))throw new qd('Unknown attribute "'+q+'" in cursor advancement object');f=m.continuePrimary||[];l=m["continue"]||[];g=m.advance||[];p=m.restart||[]}else throw new qd("scan callback output");else for(f=[],q=0;q<b.length;q++)r(Sa[q])&&(g[q]=1);for(q=Kc=m=0;q<b.length;q++)null!=f[q]||r(l[q])||null!=p[q]||null!=g[q]||Kc++;for(q=0;q<b.length;q++)if(null!=f[q]||r(l[q])||null!=p[q]||null!=g[q]){var u=Sa[q];if(!r(u))throw new Me(q+
" is not an iterator.");var u=b[u],db=La[q];if(null==Yb[q]){var Jd=q+"/"+b.length;if(null!=g[q])throw new Ne(db+" "+Jd+" must not advance "+g[q]+" steps");if(r(l[q]))throw new Ne(db+" "+Jd+" must not continue to key "+l[q]);if(null!=f[q])throw new Ne(db+" "+Jd+" must not continue to primary key "+f[q]);}Yb[q]=void 0;Jc[q]=void 0;if(null!=p[q])af(db);else if(r(l[q]))db.aa(l[q]);else if(null!=f[q])db.Da(f[q]);else if(null!=g[q])db.advance(1);else throw new Ke(u+": has no action");m++}if(0==m){for(m=
0;m<La.length;m++)$e(La[m]);P=!0;Ra(La);J(h.logger,"success "+G);e(void 0)}}}var G=d+" "+h+" scanning";I(h.logger,G);var P=!1,W,Sa=[],Yb=[],Jc=[],La=[],Kc=0;a instanceof pf?a.i(c,b,function(){f()})||f():f()},e,c);return d};
k.open=function(a,b,c,d){if(!(b instanceof U))throw new K("Second argument must be cursor range iterator.");for(var e=b.stores(),f=0;f<e.length;f++)if(!S(this.b,e[f]))throw new K('Store "'+e[f]+'" not found.');c=c||L;var g=this,h=this.a.request("open",b.stores(),c);J(this.logger,"open:"+c+" "+b);O(h,function(c){var e=Q(h);J(g.logger,e+" iterating "+b);for(var f=b.stores(),m=[],q=0;q<f.length;q++)m[q]=Yf(V(g),c,e,f[q]);var u=b.load(m);u.w=function(a){N(h,a,!0)};u.l=function(b){null!=b?(b=a.call(d,
u),!0===b?af(u):A(b)?!0===b.restart?af(u,b["continue"],b.continuePrimary):null!=b["continue"]?u.aa(b["continue"]):null!=b.continuePrimary?u.Da(b.continuePrimary):($e(u),N(h,void 0)):null===b?($e(u),N(h,void 0)):null!=b?u.aa(b):u.advance(1)):($e(u),N(h,void 0))}},this);return h};
function Xf(a,b,c,d,e){var f=[],g=c.a,h=Q(c),l=h+" "+b+"ByIterator "+d;0<e&&(l+=" limit "+e);J(a.logger,l);for(var p=V(a),t=[],m=d.stores(),q=0;q<m.length;q++)t[q]=Yf(p,g,h,m[q]);var u=d.load(t);u.w=function(a){$e(u);N(c,a,!0)};var G=0,P=!1;u.l=function(d){P||(I(a.logger,l+" starting"),P=!0);null!=d?(G++,1==b?f.push(d):2==b?f.push(u.na()):3==b?f.push([d,u.na()]):6!=b&&f.push(u.Na()),5==b?($e(u),N(c,f[0])):6==b||!r(e)||G<e?u.aa():(J(a.logger,"success:"+l+" yields "+f.length+" records"),$e(u),N(c,f))):
(J(a.logger,"success:"+l+" yields "+f.length+" records"),$e(u),N(c,5==b?f[0]:6==b?G:f))}};function Zf(a,b,c,d){this.f=a;this.g=b;this.a=Ta(c);this.b=d;this.c=[]}Zf.prototype.f=null;function $f(a,b,c){if(a.f)c&&a.c.push(c),b(a.f);else throw new rd("tx committed on ParallelTxExecutor");}Zf.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.g+" mode:"+this.b+" scopes:"+qe(this.a)};function ag(a,b,c,d,e,f){xf.call(this,a,b,c,d,e,f);this.c=this.b=null}C(ag,xf);k=ag.prototype;k.logger=H("ydn.db.tr.Parallel");k.abort=function(){J(this.logger,this+": aborting");zf(this.c)};
k.bb=function(a,b){var c;if("multi"==this.g)a:if(c=this.b,!c.a||!c.b||b!=c.b&&(c.b!=M||b!=L)||a.length>c.a.length)c=!1;else{for(var d=0;d<a.length;d++)if(-1==c.a.indexOf(a[d])){c=!1;break a}c=!0}else if("repeat"==this.g)a:if(c=this.b,c.a&&c.b&&b==c.b&&c.a.length==a.length){for(d=0;d<a.length;d++)if(-1==c.a.indexOf(a[d])){c=!1;break a}c=!0}else c=!1;else c="all"==this.g?!0:!1;return c};
k.R=function(a,b,c,d){function e(c){l.f++;p=new Zf(c,l.f,b,h);g=l.A();nd(l.logger,g+" BEGIN "+qe(b)+" "+h);l.b=p;$f(l.b,a,d)}function f(a,b){nd(l.logger,g+" "+a);if(p){for(var c=p,d=0;d<c.c.length;d++)c.c[d](a,b);c.c.length=0;c.f=null;c.a=null;c.c=null}l.a=0}var g;this.C&&(b=this.C);this.w&&(c=this.w);var h=r(c)?c:L,l=this,p;if(this.b&&this.b.f&&this.bb(b,h))$f(this.b,a,d);else{if(this.l&&this.f>=this.l)throw new qd("Exceed maximum number of transactions of "+this.l);this.j.Y(e,b,h,f)}};
k.request=function(a,b,c,d){var e=new Dd(a),f=this;this.R(function(a){f.a++;Ed(e,a,f.A()+"R"+f.a)},b,c||L,function(a,b){Fd(e);d&&d(a,b)});return e};k.Z=function(a,b,c,d,e){var f=this,g;this.R(function(c){f.a++;g=f.A()+"R"+f.a;J(f.logger,g+" BEGIN");b(c,g,function(b,d){f.c=c;g=f.A()+"R"+f.a;d?(J(f.logger,g+" ERROR"),a.o(b)):(J(f.logger,g+" SUCCESS"),a.callback(b));f.c=null});b=null;J(f.logger,g+" END")},c,d,e)};k.toString=function(){return"Parallel:"+this.g+":"+this.A()+(this.c?"*":"")};function bg(a,b){ag.call(this,a,b,yf)}C(bg,ag);k=bg.prototype;k.logger=H("ydn.db.tr.AtomicParallel");k.bb=function(){return!1};k.request=function(a,b,c){var d,e,f,g=this,h=bg.u.request.call(this,a,b,c,function(a,b){Fd(h);J(g.logger,"transaction "+a);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new tf;N(h,c,!0)}});Hd(h,function(a,b,c){f=b;e=a;d=c});return h};
k.Z=function(a,b,c,d,e){var f,g,h=new F;Kb(h,function(a){g=!1;f=a},function(a){g=!0;f=a});bg.u.Z.call(this,h,b,c,d,function(b,c){if("complete"!=b)a.o(c);else if(!0===g)a.o(f);else if(!1===g)a.callback(f);else{var d=new tf;a.o(d)}e&&(e(b,c),e=void 0)})};k.toString=function(){return"Atomic"+bg.u.toString.call(this)};function Y(a,b,c){T.call(this,a,b,c);this.W=0;a=!0;b=yf;c&&(r(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=cg(this,b,a);this.j=cg(this,"atomic",!1);this.b=this.fa(c,this.j)}C(Y,T);k=Y.prototype;k.W=0;k.cb=function(a,b,c,d,e,f){a=a||yf;var g;"readonly"==d?g=L:"readwrite"==d&&(g=M);a=cg(this,a,b,c,g,e);return this.fa(a,f?null:this.j)};k.fa=function(a){return new Ff(this,this.c,a)};
function cg(a,b,c,d,e,f){if(c){if("multi"==b||"repeat"==b||"all"==b||b==yf)return new Af(a,a.W++,b,d,e,f);if("atomic"==b)return new Ef(a,a.W++);throw new K('Invalid requestType "'+b+'"');}if("multi"==b||"repeat"==b||"all"==b||b==yf)return new ag(a,a.W++,b,d,e,f);if("atomic"==b)return new bg(a,a.W++);throw new K('Invalid requestType "'+b+'"');}
k.nb=function(a,b,c){if(3<arguments.length)throw new K("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.W++;var d=b||De(this.c),e=L;if(c)if("readwrite"==c)e=M;else if("readonly"!=c)throw new K('Invalid transaction mode "'+c+'"');var f=cg(this,"all",!1,d,e,1),g=this.fa(f,this.j),h=new Dd("run"),l=this;f.R(function(b){I(l.logger,"executing run in transaction on "+f);Ed(h,b,f.A()+"R0");a(g)},d,e,function(a){Fd(h);N(h,f.f,"complete"!==a)});
return h};k.Hb=function(){return this.b?this.b.a.f:NaN};function Z(a,b,c){Y.call(this,a,b,c);a=this.c;for(b=0;b<a.a.length;b++){c=a.a[b];var d=S(a,c.getName());if(d){if(!se(d,"k"))throw new K('full text index store "'+d.getName()+'" must have "keyword" index');if(!se(d,"v"))throw new K('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.keyPath)throw new K('full text index store "'+d.getName()+'" must use "id" as key path.');}else throw new K('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=
c.index(d),f=S(a,e.a);if(f)md(this.logger,"Full text indexer option for "+f.getName()+" ignored.");else throw new K('full text source store "'+e.a+'" does not exist for full text index "'+c.getName()+'"');}}}C(Z,Y);k=Z.prototype;k.fa=function(a){return new X(this,this.c,a)};k.add=function(a,b,c){return this.b.add(a,b,c)};k.oa=function(a,b,c){return this.b.oa(a,b,c)};k.count=function(a,b,c,d){return this.b.count(a,b,c,d)};k.get=function(a,b){return this.b.get(a,b)};
k.keys=function(a,b,c,d,e,f,g){return this.b.keys(a,b,c,d,e,f,g)};k.da=function(a,b,c,d,e,f,g){return this.b.da(a,b,c,d,e,f,g)};k.values=function(a,b,c,d,e,f){return this.b.values(a,b,c,d,e,f)};k.ia=function(a,b,c,d,e,f,g){return this.b.ia(a,b,c,d,e,f,g)};k.put=function(a,b,c){return this.b.put(a,b,c)};k.ya=function(a,b,c){return this.b.ya(a,b,c)};k.clear=function(a,b,c){return this.b.clear(a,b,c)};k.Aa=function(a,b,c){return this.b.Aa(a,b,c)};
k.toString=function(){var a="Storage:"+this.getName();Te(this)&&(a+=" ["+this.ma()+"]");return a};function dg(a,b,c){Z.call(this,a,b,c)}C(dg,Z);k=dg.prototype;k.fa=function(a){return new Wf(this,this.c,a)};k.open=function(a,b,c,d){return this.b.open(a,b,c,d)};k.ba=function(a){return this.b.ba(a)};k.ja=function(a,b){return this.b.ja(a,b)};k.ea=function(a,b){return this.b.ea(a,b)};k.Eb=function(a,b){return this.b.Za(a,b)};function eg(a,b,c){We.call(this,a,b,c);this.b=null}C(eg,We);k=eg.prototype;k.logger=H("ydn.db.core.req.IDBCursor");k.sa=function(a){(a=a.target.result)?Ye(this,a.key,a.primaryKey,a.value):Ye(this)};
k.openCursor=function(a,b){function c(a,b,c){m.b=t;m.b.onsuccess=B(m.sa,m);Ye(m,a,m.j?b:void 0,c);t=null}var d=this+" opening ";null!=a&&(d+="{"+a,d=null!=b?d+(";"+b+"}"):d+"}");I(this.logger,d);var e=this.Ja,d=this.f.objectStore(this.Oa),f=x(this.h)?d.index(this.h):null;if(r(a))var g=f?!r(b):!0,h=e?e.lower:void 0,l=e?e.upper:void 0,p=e?!!e.lowerOpen:!1,e=e?!!e.upperOpen:!1,e=$d(this.reverse?new R(h,a,p,g):new R(a,l,g,e));var t;this.Ia?f?t=null!=this.dir?f.openKeyCursor(e,this.dir):null!=e?f.openKeyCursor(e):
f.openKeyCursor():t=null!=this.dir?d.openCursor(e,this.dir):null!=e?d.openCursor(e):d.openCursor():f?t=null!=this.dir?f.openCursor(e,this.dir):null!=e?f.openCursor(e):f.openCursor():t=null!=this.dir?d.openCursor(e,this.dir):null!=e?d.openCursor(e):d.openCursor();var m=this;t.onerror=function(a){var b=t.error;a.preventDefault();m.w(b);Ze(m);m.g=!0};null!=a?t.onsuccess=function(d){if(d=d.target.result){var e=wd.cmp(d.key,a),f=m.reverse?-1:1;if(e==f)c(d.key,d.primaryKey,d.value);else if(e==-f)d["continue"](a);
else if(null!=b)if(wd.cmp(d.primaryKey,b)==f)c(d.key,d.primaryKey,d.value);else d["continue"]();else d["continue"]()}else c()}:(m.b=t,m.b.onsuccess=B(m.sa,m))};k.update=function(a){var b=this.b.result;if(b){var c=new F;a=b.update(a);a.onsuccess=function(a){c.callback(a.target.result)};a.onerror=function(a){a.preventDefault();c.o(a)};return c}throw new rf("cursor gone");};
k.clear=function(){var a=this.b.result;if(a){var b=new F,a=a["delete"]();a.onsuccess=function(){b.callback(1)};a.onerror=function(a){a.preventDefault();b.o(a)};return b}throw new rf("cursor gone");};k.advance=function(a){var b=this.b.result;if(1==a)b["continue"]();else b.advance(a)};
k.Da=function(a){var b=this.b.result,c=wd.cmp(a,b.primaryKey);if(c!=(this.reverse?-1:1))throw new rd('continuing primary key "'+a+'" must '+(this.reverse?"lower":"higher")+' than current primary key "'+b.primaryKey+'"');var d=this;this.b.onsuccess=function(e){if(b=e.target.result)if(c=wd.cmp(b.primaryKey,a),0==c||1==c&&!d.reverse||-1==c&&d.reverse)d.b.onsuccess=B(d.sa,d),Ye(d,b.key,d.j?b.primaryKey:void 0,b.value);else b["continue"]();else d.b.onsuccess=B(d.sa,d),Ye(d)};b["continue"]()};
k.aa=function(a){var b=this.b.result;if(null!=a)b["continue"](a);else b["continue"]()};k.L=function(){eg.u.L.call(this);this.b=null};k.toString=function(){return"IDB"+eg.u.toString.call(this)};function fg(a,b){this.a=b}C(fg,uf);fg.prototype.logger=H("ydn.db.crud.req.IndexedDb");function If(a,b,c){function d(a){var g=b.a.objectStore(c[a]).count();g.onsuccess=function(g){e[a]=g.target.result;a++;a==c.length?N(b,e):d(a)};g.onerror=function(a){a.preventDefault();N(b,g.error,!0)}}var e=[];0==c.length?N(b,[]):d(0)}
function Of(a,b,c,d,e,f,g){function h(u){if(null==f[u])if(I(a.logger,"empty object at "+u+" of "+f.length),p++,p==f.length)N(b,l,t);else{var P=u+10;P<f.length&&h(P)}var W,P=f[u];W=g&&null!=g[u]?c?q.put(P,g[u]):q.add(P,g[u]):c?q.put(P):q.add(P);W.onsuccess=function(a){p++;l[u]=a.target.result;p==f.length?N(b,d?l[0]:l,t):(a=u+10,a<f.length&&h(a))};W.onerror=function(c){p++;var g=W.error;I(a.logger,Q(b)+m+' request to "'+e+'" cause '+g.name+' for object "'+ye(f[u])+'" at index '+u+" of "+f.length+" objects.");
l[u]=g;t=!0;c.preventDefault();p==f.length?N(b,d?l[0]:l,t):(c=u+10,c<f.length&&h(c))}}var l=[],p=0,t=!1,m=c?"put":"add",q=b.a.objectStore(e);I(a.logger,Q(b)+" "+m+" "+f.length+' objects to store "'+e+'"');if(0<f.length)for(var u=0;10>u&&u<f.length;u++)h(u);else N(b,[])}
function Pf(a,b,c,d){function e(l){var t=d[l],m=t.a,q=b.a.objectStore(m),u;u=null===q.keyPath?q.put(c[l],t.id):q.put(c[l]);u.onsuccess=function(a){g++;f[l]=a.target.result;g==c.length?N(b,f,h):(a=l+10,a<c.length&&e(a))};u.onerror=function(d){g++;md(a.logger,"request result "+d.name+' error when put keys to "'+m+'" for object "'+ye(c[l])+'" at index '+l+" of "+c.length+" objects.");f[l]=u.error;h=!0;d.preventDefault();g==c.length?N(b,f,h):(d=l+10,d<c.length&&e(d))}}var f=[],g=0,h=!1;I(a.logger,Q(b)+
" putByKeys: of "+c.length+" objects");if(0<c.length)for(var l=0;10>l&&l<c.length;l++)e(l);else N(b,f,h)}function Tf(a,b,c,d){var e=b.a.objectStore(c);I(a.logger,Q(b)+" clearById: "+c+" "+d);var f=e.openCursor(ge.only(d));f.onsuccess=function(a){if(a=a.target.result){var c=a["delete"]();c.onsuccess=function(){N(b,1)};c.onerror=function(){N(b,c.error,!0)}}else N(b,0)};f.onerror=function(a){a.preventDefault();N(b,f.error,!0)}}
function Vf(a,b,c){function d(a){a++;if(a>=c.length)0<h.length?N(b,h,!0):N(b,e);else{c[a].a!=f&&(f=c[a].a,g=b.a.objectStore(f));var p=g["delete"](c[a].id);p.onsuccess=function(){e++;d(a)};p.onerror=function(b){b.preventDefault();h[a]=p.error;d(a)}}}var e=0,f,g;I(a.logger,Q(b)+" removeByKeys: "+c.length+" keys");var h=[];d(-1)}
function Uf(a,b,c,d){var e=b.a.objectStore(c),f=e.count(d);I(a.logger,Q(b)+" clearByKeyRange: "+c+" "+d);f.onsuccess=function(a){var c=a.target.result,f=e["delete"](d);f.onsuccess=function(){N(b,c)};f.onerror=function(){N(b,f.error,!0)}};f.onerror=function(a){a.preventDefault();N(b,f.error,!0)}}function Qf(a,b,c,d){var e=b.a.objectStore(c);I(a.logger,Q(b)+" "+c+" "+d);var f=e["delete"](d);f.onsuccess=function(){N(b,void 0)};f.onerror=function(a){a.preventDefault();N(b,f.error,!0)}}
function Sf(a,b,c,d,e){var f=b.a.objectStore(c).index(d);I(a.logger,Q(b)+" clearByIndexKeyRange: "+c+":"+d+" "+e);var g=[],h=f.openCursor(e),l=0;h.onsuccess=function(a){var c=a.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){l++;c["continue"]()};d.onerror=function(a){g.push(d.error);a.preventDefault();c["continue"]()}}else 0<g.length?N(b,g,!0):N(b,l)};h.onerror=function(a){a.preventDefault();N(b,h.error,!0)}}
function Rf(a,b,c){var d=c.length,e=0;I(a.logger,Q(b)+" clearByStores: "+c);for(a=0;a<d;a++){var f=b.a.objectStore(c[a]).clear();f.onsuccess=function(){e++;e==d&&N(b,e)};f.onerror=function(a){e++;a.preventDefault();e==d&&N(b,f.error,!0)}}}
function Kf(a,b,c,d){I(a.logger,Q(b)+c+":"+d);var e=b.a.objectStore(c),f=e.get(d);f.onsuccess=function(c){I(a.logger,Q(b)+" record "+d+(null!=c.target.result?" ":" not ")+" exists.");var f=c.target.result;if(!e.keyPath&&0==e.indexNames.length&&Fc&&x(f)&&0<=f.indexOf(";base64,")){'"'==f.charAt(0)&&'"'==f.charAt(f.length-1)&&(f=f.substr(1,f.length-2));f=f.split(";base64,");c=f[0].split(":")[1];for(var f=window.atob(f[1]),l=f.length,p=new Uint8Array(l),t=0;t<l;++t)p[t]=f.charCodeAt(t);N(b,new Blob([p.buffer],
{type:c}))}else N(b,c.target.result)};f.onerror=function(a){a.preventDefault();N(b,f.error,!0)}}
function Mf(a,b,c,d){function e(a){if(null==d[a])if(g++,f[a]=void 0,g==l)N(b,f);else{var c=a+10;c<l&&e(c)}var m;m=h.get(d[a]);m.onsuccess=function(c){g++;f[a]=c.target.result;g==l?N(b,f):(c=a+10,c<l&&e(c))};m.onerror=function(a){g++;a.preventDefault();N(b,m.error,!0)}}var f=[];f.length=d.length;var g=0,h=b.a.objectStore(c),l=d.length;I(a.logger,Q(b)+" "+c+":"+l+" ids");if(0<l)for(a=0;10>a&&a<l;a++)e(a);else N(b,[])}
function Nf(a,b,c){function d(a){var h=c[a],l=b.a.objectStore(h.a).get(h.id);l.onsuccess=function(h){f++;e[a]=h.target.result;f==c.length?N(b,e):(h=a+10,h<c.length&&d(h))};l.onerror=function(a){f++;a.preventDefault();N(b,l.error,!0)}}var e=[];e.length=c.length;var f=0;I(a.logger,Q(b)+" "+c.length+" ids");if(0<c.length)for(a=0;10>a&&a<c.length;a++)d(a);else N(b,[])}
function Jf(a,b,c,d,e,f){if(e&&f)throw new qd("unique count not available in IndexedDB");f=b.a.objectStore(c);c=Q(b)+" "+c+(e?":"+e:"")+(d?":"+qe(d):"");I(a.logger,c);var g;null!=e?(a=f.index(e),g=null!=d?a.count(d):a.count()):g=null!=d?f.count(d):f.count();g.onsuccess=function(a){N(b,a.target.result)};g.onerror=function(a){a.preventDefault();N(b,g.error,!0)}}
function gg(a,b,c,d){var e=b.getAll(c,d);e.onsuccess=function(b){N(a,b.target.result)};e.onerror=function(b){b.preventDefault();N(a,e.error,!0)}}function hg(a,b,c,d){var e=b.getAllKeys(c,d);e.onsuccess=function(b){N(a,b.target.result)};e.onerror=function(b){b.preventDefault();N(a,e.error,!0)}}
function Lf(a,b,c,d,e,f,g,h,l,p){var t=[],m=b.a.objectStore(d),q=l?p?"prevunique":"prev":p?"nextunique":"next";d=Q(b)+" "+c+" "+d+(e?":"+e:"")+(f?qe(f):"");l&&(d+=" reverse");p&&(d+=" unique");I(a.logger,d);var u;if(1==c||2==c||3==c)if(e){a=m.index(e);if(2==c&&a.getAllKeys&&!p&&!h&&!l){hg(b,a,f,g);return}u=a.openKeyCursor(f,q)}else{if(2==c&&m.getAllKeys&&!p&&!h&&!l){hg(b,m,f,g);return}u=m.openCursor(f,q)}else if(e){a=m.index(e);if(a.getAll&&!p&&!h&&!l){gg(b,a,f,g);return}u=a.openCursor(f,q)}else{if(m.getAll&&
!p&&!h&&!l){gg(b,m,f,g);return}u=m.openCursor(f,q)}var G=!1;u.onsuccess=function(a){if(a=a.target.result){if(!G){if(0<h){G=!0;a.advance(h);return}G=!0}if(1==c)t.push(a.key);else if(2==c)t.push(a.primaryKey);else if(3==c){var d={};e&&(d[e]=a.key);m.keyPath?d[m.keyPath]=a.primaryKey:d._ROWID_=a.primaryKey;t.push(d)}else 4==c?t.push(a.value):t.push([a.key,a.primaryKey,a.value]);if(t.length<g)a["continue"]();else N(b,t)}else N(b,t)};u.onerror=function(a){a.preventDefault();N(b,u.error,!0)}};function Gf(a,b){this.a=b}C(Gf,fg);Gf.prototype.logger=H("ydn.db.core.req.IndexedDb");function Yf(a,b,c,d){a=S(a.a,d);return new eg(b,c,a)};function ig(a,b){r(a)&&5242880<a&&ld(this.logger,Zc,"storage size request ignored, use Quota Management API instead");this.s=null;this.ga=b||NaN}k=ig.prototype;
k.connect=function(a,b){function c(a,c,d){J(e.logger,(d?"changing":"upgrading")+" version to "+a.version+" from "+g);for(d=0;d<b.stores.length;d++)jg(e,a,c,b.stores[d]);c=a.objectStoreNames;var f=c.length;for(d=0;d<f;d++)Ee(b,c[d])||(a.deleteObjectStore(c[d]),J(e.logger,"store: "+c[d]+" deleted."))}function d(a,b){f.c?md(e.logger,"database already set."):r(b)?(md(e.logger,b?b.message:"Error received."),e.s=null,f.o(b)):(e.s=a,e.s.onabort=function(a){I(e.logger,e+": abort");e.Ma(a.target.error)},e.s.onerror=
function(a){I(e.logger,e+": error");e.Ma(a.target.error)},e.s.onversionchange=function(a){I(e.logger,e+" closing connection for onversionchange to: "+a.version);if(e.s&&(e.s.onabort=null,e.s.onblocked=null,e.s.onerror=null,e.s.onversionchange=null,e.Wa(a),!a.defaultPrevented)){e.s.close();e.s=null;var b=Error();b.name=a.type;e.Ya(b)}},f.callback(parseFloat(g)))}var e=this,f=new F,g=void 0,h=b.version;ld(this.logger,cd,"Opening database: "+a+" ver: "+(b.wa?"auto":h));var l;l=r(h)?wd.open(a,h):wd.open(a);
l.onsuccess=function(f){var h=f.target.result;r(g)||(g=h.version);ld(e.logger,cd,"Database: "+h.name+", ver: "+h.version+" opened.");if(b.wa)Pe(e,function(f){if(b instanceof Ge)for(var g=0;g<f.stores.length;g++)Ee(b,f.stores[g].getName())||He(b,f.stores[g].clone());f=Fe(b,f);if(0<f.length){ld(e.logger,cd,"Schema change require for difference in "+f);f=y(h.version)?h.version+1:1;h.close();var l=wd.open(a,f);l.onupgradeneeded=function(a){a=a.target.result;ld(e.logger,cd,"re-open for version "+a.version);
c(a,l.transaction,!1)};l.onsuccess=function(a){d(a.target.result)};l.onerror=function(){ld(e.logger,cd,e+": fail.");d(null)}}else d(h)},void 0,h);else if(b.version>h.version){var l=h.setVersion(b.version);l.a=function(a){md(e.logger,"migrating from "+h.version+" to "+b.version+" failed.");d(null,a)};l.onsuccess=function(){c(h,l.transaction,!0)}}else b.version==h.version?ld(e.logger,cd,"database version "+h.version+" ready to go"):md(e.logger,"connected database version "+h.version+" is higher than requested version."),
Pe(e,function(a){a=Fe(b,a);0<a.length?(ld(e.logger,cd,a),d(null,new Le("different schema: "+a))):d(h)},void 0,h)};l.onupgradeneeded=function(a){a=a.target.result;g=NaN;ld(this.logger,cd,"upgrade needed for version "+a.version);c(a,l.transaction,!1)};l.onerror=function(c){var f=e.logger;f&&f.log(Yc,'open request to database "'+a+'" '+(r(b.version)?" with version "+b.version:"")+" cause error of "+l.error.name,void 0);d(null,c)};l.onblocked=function(c){var f=e.logger;f&&f.log(Yc,"database "+a+" "+b.version+
" block, close other connections.",void 0);d(null,c)};y(this.ga)&&!isNaN(this.ga)&&setTimeout(function(){if("done"!=l.readyState){var a=e.logger;a&&a.log(Yc,e+": database state is still "+l.readyState,void 0);d(null,new tf("connection timeout after "+e.ga))}},this.ga);return f};k.ga=18E4;k.Ya=function(){};k.Ma=function(){};k.Wa=function(){};k.logger=H("ydn.db.con.IndexedDb");k.s=null;
function Pe(a,b,c,d){a=d||a.s;if(r(c)){if(null===c){if(0==a.objectStoreNames.length){b(new Ce(a.version));return}throw new Ke;}a=c.db}else{c=[];for(d=a.objectStoreNames.length-1;0<=d;d--)c[d]=a.objectStoreNames[d];if(0==c.length){b(new Ce(a.version));return}c=a.transaction(c,L)}var e=a.objectStoreNames,f=[],g=e.length;for(d=0;d<g;d++){for(var h=c.objectStore(e[d]),l=[],p=0,t=h.indexNames.length;p<t;p++){var m=h.index(h.indexNames[p]);l[p]=new je(m.keyPath,void 0,m.unique,m.multiEntry,m.name)}f[d]=
new oe(h.name,h.keyPath,h.autoIncrement,void 0,l)}c=new Ce(a.version,f);b(c)}
function jg(a,b,c,d){function e(){var a={autoIncrement:!!d.b};null!=d.keyPath&&(a.keyPath=d.keyPath);return b.createObjectStore(d.getName(),a)}ld(a.logger,dd,"Creating Object Store for "+d.getName()+" keyPath: "+d.keyPath);if(b.objectStoreNames.contains(d.getName())){c=c.objectStore(d.getName());me(d.keyPath||"",c.keyPath||"")?(b.deleteObjectStore(d.getName()),ld(a.logger,Zc,"store: "+d.getName()+" deleted due to keyPath change."),c=e()):da(c.autoIncrement)&&da(d.b)&&c.autoIncrement!=d.b&&(b.deleteObjectStore(d.getName()),
ld(a.logger,Zc,"store: "+d.getName()+" deleted due to autoIncrement change."),c=e());for(var f=c.indexNames,g=0;g<d.a.length;g++){var h=d.index(g);!f.contains(h.getName())&&h.c&&(c.clear(),ld(a.logger,Zc,"store: "+d.getName()+" cleared since generator index need re-indexing."))}for(var l=0,p=0,t=0,g=0;g<d.a.length;g++){var h=d.index(g),m=!1;if(f.contains(h.getName())){var q=c.index(h.getName()),u=null!=q.unique&&null!=h.unique&&q.unique!=h.unique,G=null!=q.multiEntry&&null!=h.multiEntry&&q.multiEntry!=
h.multiEntry,q=null!=q.keyPath&&null!=h.keyPath&&!!me(q.keyPath,h.keyPath);if(u||G||q)c.deleteIndex(h.getName()),m=!0,l--,t++}else"BLOB"!=h.type&&(m=!0);m&&(h.unique||h.multiEntry?(m={unique:h.unique,multiEntry:h.multiEntry},c.createIndex(h.getName(),h.keyPath,m)):c.createIndex(h.getName(),h.keyPath),l++)}for(g=0;g<f.length;g++)se(d,f[g])||(c.deleteIndex(f[g]),p++);ld(a.logger,dd,"Updated store: "+c.name+", "+l+" index created, "+p+" index deleted, "+t+" modified.")}else{c=e();for(g=0;g<d.a.length;g++)h=
d.index(g),"BLOB"==h.type?ld(a.logger,$c,"Index "+h+" of blob data type ignored."):(I(a.logger,"Creating index: "+h+" for "+d.getName()),h.unique||h.multiEntry?(m={unique:h.unique,multiEntry:h.multiEntry},c.createIndex(h.getName(),h.keyPath,m)):c.createIndex(h.getName(),h.keyPath));J(a.logger,"Created store: "+c)}}
function Ve(a,b,c,d,e){a=a.s;if(!c){c=[];for(var f=a.objectStoreNames.length-1;0<=f;f--)c[f]=a.objectStoreNames[f]}0==c.length?b(null):(c=a.transaction(c,d),c.oncomplete=function(a){e("complete",a)},c.onabort=function(a){e("abort",a)},b(c),b=null)}k.close=function(){ld(this.logger,dd,this+" closing connection");this.s.close()};k.toString=function(){return"IndexedDB:"+(this.s?this.s.name+":"+this.s.version:"")};
Ld.push(function(a,b){if(!wd||b&&"indexeddb"!=b)return null;var c=wd.deleteDatabase(a),d=new Dd("IDBVersionChangeEvent ");c.onblocked=function(a){td(d,a)};c.onerror=function(a){d.o(a)};c.onsuccess=function(a){d.callback(a)};return d});Y.prototype.Ea=function(a){return"indexeddb"==a&&wd?new ig(this.C,this.v):null};Y.prototype.branch=Y.prototype.cb;Y.prototype.getTxNo=Y.prototype.Hb;Ff.prototype.getTxNo=Ff.prototype.g;Y.prototype.run=Y.prototype.nb;Z.prototype.branch=Z.prototype.cb;Z.prototype.add=Z.prototype.add;Z.prototype.addAll=Z.prototype.oa;Z.prototype.get=Z.prototype.get;Z.prototype.keys=Z.prototype.keys;Z.prototype.keysByIndex=Z.prototype.da;Z.prototype.values=Z.prototype.values;Z.prototype.valuesByIndex=Z.prototype.ia;Z.prototype.put=Z.prototype.put;Z.prototype.putAll=Z.prototype.ya;Z.prototype.clear=Z.prototype.clear;Z.prototype.remove=Z.prototype.Aa;Z.prototype.count=Z.prototype.count;X.prototype.add=X.prototype.add;
X.prototype.addAll=X.prototype.oa;X.prototype.get=X.prototype.get;X.prototype.keys=X.prototype.keys;X.prototype.keysByIndex=X.prototype.da;X.prototype.values=X.prototype.values;X.prototype.valuesByIndex=X.prototype.ia;X.prototype.put=X.prototype.put;X.prototype.putAll=X.prototype.ya;X.prototype.clear=X.prototype.clear;X.prototype.remove=X.prototype.Aa;X.prototype.count=X.prototype.count;ka("ydn.db.Key",Xd);Xd.prototype.id=Xd.prototype.hb;Xd.prototype.parent=Xd.prototype.Ab;
Xd.prototype.storeName=Xd.prototype.Bb;ka("ydn.db.KeyRange",R);R.upperBound=de;R.lowerBound=ee;R.bound=ce;R.only=be;R.starts=fe;Rd.prototype.store_name=Rd.prototype.b;Rd.prototype.getStoreName=Rd.prototype.c;Vd.prototype.name=Vd.prototype.name;Vd.prototype.getKey=Vd.prototype.f;Vd.prototype.getValue=Vd.prototype.g;Wd.prototype.name=Wd.prototype.name;Wd.prototype.getKeys=Wd.prototype.U;Wd.prototype.getValues=Wd.prototype.Ga;function kg(a,b,c){Z.call(this,a,b,c)}C(kg,dg);ka("ydn.db.Storage",kg);function lg(){this.a=ja()}var mg=new lg;lg.prototype.reset=function(){this.a=ja()};lg.prototype.get=function(){return this.a};function ng(a){this.h=a||"";this.i=mg}ng.prototype.c=!0;ng.prototype.a=!0;ng.prototype.b=!1;function og(a){a=new Date(a.g);return pg(a.getFullYear()-2E3)+pg(a.getMonth()+1)+pg(a.getDate())+" "+pg(a.getHours())+":"+pg(a.getMinutes())+":"+pg(a.getSeconds())+"."+pg(Math.floor(a.getMilliseconds()/10))}function pg(a){return 10>a?"0"+a:String(a)}function qg(a,b){var c=(a.g-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d}function rg(a){ng.call(this,a)}C(rg,ng);
rg.prototype.b=!0;rg.prototype.f=function(a){return a?this.g(a).I():""};
rg.prototype.g=function(a){if(!a)return sc;var b;switch(a.f.value){case Xc.value:b="dbg-sh";break;case Yc.value:b="dbg-sev";break;case Zc.value:b="dbg-w";break;case $c.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.h," ");this.a&&c.push("[",og(a),"] ");c.push("[",qg(a,this.i.get()),"s] ");c.push("[",a.b,"] ");var c=mc(c.join("")),d=sc;if(this.b&&a.a){var d=qc("br"),e;try{var f;var g=a.a,h=aa("window.location.href");if(x(g))f={message:g,name:"Unknown error",lineNumber:"Not available",
fileName:h,stack:"Not available"};else{var l,p,t=!1;try{l=g.lineNumber||g.Jb||"Not available"}catch(W){l="Not available",t=!0}try{p=g.fileName||g.filename||g.sourceURL||n.$googDebugFname||h}catch(W){p="Not available",t=!0}f=!t&&g.lineNumber&&g.fileName&&g.stack&&g.message&&g.name?g:{message:g.message||"Not available",name:g.name||"UnknownError",lineNumber:l,fileName:p,stack:g.stack||"Not available"}}var m;var q=f.fileName;null!=q||(q="");if(/^https?:\/\//i.test(q)){var u=dc(q);Tb("view-source scheme plus HTTP/HTTPS URL");
var G="view-source:"+bc(u);m=ec(G)}else{var P=Tb("sanitizedviewsrc");m=ec(Sb(P))}e=rc(mc("Message: "+f.message+"\nUrl: "),qc("a",{href:m,target:"_new"},f.fileName),mc("\nLine: "+f.lineNumber+"\n\nBrowser stack:\n"+f.stack+"-> [end]\n\nJS stack traversal:\n"+Pc(void 0)+"-> "))}catch(W){e=mc("Exception trying to expose exception! You win, we lose. "+W)}d=rc(d,e)}a=mc(a.c);b=qc("span",{"class":b},rc(a,d));return this.c?rc(c,b,qc("br")):rc(c,b)};function sg(a){ng.call(this,a)}C(sg,ng);
sg.prototype.f=function(a){var b=[];b.push(this.h," ");this.a&&b.push("[",og(a),"] ");b.push("[",qg(a,this.i.get()),"s] ");b.push("[",a.b,"] ");b.push(a.c);this.b&&(a=a.a)&&b.push("\n",a instanceof Error?a.message:a.toString());this.c&&b.push("\n");return b.join("")};sg.prototype.g=function(a){return mc(sg.prototype.f(a))};function tg(){this.g=B(this.h,this);this.a=new sg;this.a.a=!1;this.a.b=!1;this.b=this.a.c=!1;this.c="";this.f={}}tg.prototype.h=function(a){if(!this.f[a.b]){var b=this.a.f(a),c=ug;if(c)switch(a.f){case Xc:vg(c,"info",b);break;case Yc:vg(c,"error",b);break;case Zc:vg(c,"warn",b);break;default:vg(c,"debug",b)}else this.c+=b}};var ug=n.console;function vg(a,b,c){if(a[b])a[b](c);else a.log(c)};var wg=!Cc||9<=Oc;!Ec&&!Cc||Cc&&9<=Oc||Ec&&Mc("1.9.1");Cc&&Mc("9");function xg(a,b){$a(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:yg.hasOwnProperty(d)?a.setAttribute(yg[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}var yg={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function zg(a,b,c){function d(c){c&&b.appendChild(x(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!w(f)||A(f)&&0<f.nodeType?d(f):Ma(Ag(f)?Ta(f):f,d)}}function Ag(a){if(a&&"number"==typeof a.length){if(A(a))return"function"==typeof a.item||"string"==typeof a.item;if(z(a))return"function"==typeof a.item}return!1}function Bg(a){this.a=a||n.document||document}
function Cg(a,b){var c;c=a.a;var d=b&&"*"!=b?b.toUpperCase():"";c.querySelectorAll&&c.querySelector&&d?c=c.querySelectorAll(d+""):c=c.getElementsByTagName(d||"*");return c}
Bg.prototype.b=function(a,b,c){var d=this.a,e=arguments,f=e[0],g=e[1];if(!wg&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',ra(g.name),'"');if(g.type){f.push(' type="',ra(g.type),'"');var h={};cb(h,g);delete h.type;g=h}f.push(">");f=f.join("")}f=d.createElement(f);g&&(x(g)?f.className=g:v(g)?f.className=g.join(" "):xg(f,g));2<e.length&&zg(d,f,e);return f};
Bg.prototype.contains=function(a,b){if(!a||!b)return!1;if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||!!(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};function Dg(a){Dg[" "](a);return a}Dg[" "]=ba;function Eg(a){Cc&&r(a.cssText)?a.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":a.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}"}
;function Fg(a){this.g=B(this.h,this);this.b=new rg;this.c=this.b.a=!1;this.a=a;this.f=this.a.ownerDocument||this.a.document;a=(a=this.a)?new Bg(9==a.nodeType?a:a.ownerDocument||a.document):oa||(oa=new Bg);var b=null,c=a.a;Cc&&c.createStyleSheet?(b=c.createStyleSheet(),Eg(b)):(c=Cg(a,"HEAD")[0],c||(b=Cg(a,"BODY")[0],c=a.b("HEAD"),b.parentNode.insertBefore(c,b)),b=a.b("STYLE"),Eg(b),c.appendChild(b));this.a.className+=" logdiv"}
Fg.prototype.h=function(a){if(a){var b=100>=this.a.scrollHeight-this.a.scrollTop-this.a.clientHeight,c=this.f.createElement("DIV");c.className="logmsg";a=this.b.g(a);c.innerHTML=jc(a);this.a.appendChild(c);b&&(this.a.scrollTop=this.a.scrollHeight)}};Fg.prototype.clear=function(){this.a&&(this.a.innerHTML=jc(sc))};var Gg=!Cc||9<=Oc,Hg=Cc&&!Mc("9");!Fc||Mc("528");Ec&&Mc("1.9b")||Cc&&Mc("8")||Bc&&Mc("9.5")||Fc&&Mc("528");Ec&&!Mc("8")||Cc&&Mc("9");function Ig(a,b){Qd.call(this,a?a.type:"");this.a=this.target=null;this.clientY=this.clientX=0;this.b=null;if(a){this.type=a.type;var c=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.a=b;var d=a.relatedTarget;if(d&&Ec)try{Dg(d.nodeName)}catch(e){}null===c?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY):(this.clientX=void 0!==c.clientX?c.clientX:c.pageX,this.clientY=void 0!==c.clientY?c.clientY:c.pageY);this.b=
a;a.defaultPrevented&&this.preventDefault()}}C(Ig,Qd);Ig.prototype.preventDefault=function(){Ig.u.preventDefault.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Hg)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Jg=null,Kg=null;H("ydn.debug");ka("ydn.debug.log",function(a,b,c){a=a||"ydn";if(y(b))b=new Wc("log",b);else if(x(b)){b=b.toUpperCase();if(!fd){fd={};for(var d=0,e;e=ed[d];d++)fd[e.value]=e,fd[e.name]=e}b=fd[b]||null}else b=bd;(d=H(a))?d.b=b:window.console.log("logger "+a+" not available.");r(c)?!Kg&&(a=Kg=new Fg(c),1!=a.c&&(c=kd(),b=a.g,c.a||(c.a=[]),c.a.push(b),a.c=!0),a=kd())&&(a.b=Zc):!Jg&&!Kg&&(a=Jg=new tg,1!=a.b&&(c=kd(),b=a.g,c.a||(c.a=[]),c.a.push(b),a.b=!0),a=kd())&&(a.b=Zc)});function Lg(a,b){Nd.call(this);this.f=b;this.a=[];if(a>this.f)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var c=0;c<a;c++)this.a.push(this.b())}C(Lg,Nd);function Mg(a,b){a.a.length<a.f?a.a.push(b):a.c(b)}Lg.prototype.b=function(){return{}};Lg.prototype.c=function(a){if(A(a))if(z(a.Sa))a.Sa();else for(var b in a)delete a[b]};Lg.prototype.L=function(){Lg.u.L.call(this);for(var a=this.a;a.length;)this.c(a.pop());delete this.a};function Ng(){this.a=[];this.g=new xc;this.m=this.v=this.w=this.i=0;this.b=new xc;this.h=this.l=0;this.C=1;this.c=new Lg(0,4E3);this.c.b=function(){return new Og};this.j=new Lg(0,50);this.j.b=function(){return new Pg};var a=this;this.f=new Lg(0,2E3);this.f.b=function(){return String(a.C++)};this.f.c=function(){}}H("goog.debug.Trace");function Pg(){this.Ka=this.time=this.count=0}
Pg.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");this.Ka&&a.push(" [VarAlloc = ",this.Ka,"]");return a.join("")};function Og(){}function Qg(a,b,c,d){var e=[];-1==c?e.push("    "):e.push(Rg(a.b-c));e.push(" ",Sg(a.b-b));0==a.a?e.push(" Start        "):1==a.a?(e.push(" Done "),e.push(Rg(a.g-a.startTime)," ms ")):e.push(" Comment      ");e.push(d,a);0<a.f&&e.push("[VarAlloc ",a.f,"] ");return e.join("")}
Og.prototype.toString=function(){return null==this.type?this.c:"["+this.type+"] "+this.c};Ng.prototype.reset=function(){for(var a=0;a<this.a.length;a++){var b=this.c.id;b&&Mg(this.f,b);Mg(this.c,this.a[a])}this.a.length=0;this.g.clear();this.i=ja();this.h=this.l=this.m=this.v=this.w=0;b=this.b.U();for(a=0;a<b.length;a++){var c=this.b.get(b[a]);c.count=0;c.time=0;c.Ka=0;Mg(this.j,c)}this.b.clear()};
Ng.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.a.length;d++){var e=this.a[d];1==e.a&&c.pop();a.push(" ",Qg(e,this.i,b,c.join("")));b=e.b;a.push("\n");0==e.a&&c.push("|  ")}if(0!=this.g.Ta()){var f=ja();a.push(" Unstopped timers:\n");wc(this.g,function(b){a.push("  ",b," (",f-b.startTime," ms, started at ",Sg(b.startTime),")\n")})}b=this.b.U();for(d=0;d<b.length;d++)c=this.b.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",this.l,"\n","Total comments created ",
this.h,"\n","Overhead start: ",this.w," ms\n","Overhead end: ",this.v," ms\n","Overhead comment: ",this.m," ms\n");return a.join("")};function Rg(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a}function Sg(a){a=Math.round(a);return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+a%1E3).substring(1,4)}new Ng;var Tg="closure_listenable_"+(1E6*Math.random()|0),Ug=0;function Vg(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.qa=!!d;this.ua=e;this.key=++Ug;this.X=this.pa=!1}function Wg(a){a.X=!0;a.listener=null;a.a=null;a.src=null;a.ua=null};function Xg(a){this.src=a;this.a={};this.b=0}Xg.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=Yg(a,b,d,e);-1<g?(b=a[g],c||(b.pa=!1)):(b=new Vg(b,this.src,f,!!d,e),b.pa=c,a.push(b));return b};function Zg(a,b){var c=b.type;if(c in a.a){var d=a.a[c],e=D(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Wg(b),0==a.a[c].length&&(delete a.a[c],a.b--))}}
function Yg(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.X&&f.listener==b&&f.qa==!!c&&f.ua==d)return e}return-1};var $g="closure_lm_"+(1E6*Math.random()|0),ah={},bh=0;function ch(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)ch(a,b[f],c,d,e);else c=dh(c),a&&a[Tg]?a.M.add(String(b),c,!1,d,e):eh(a,b,c,!1,d,e)}
function eh(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=fh(a);h||(a[$g]=h=new Xg(a));c=h.add(b,c,d,e,f);if(!c.a){d=gh();c.a=d;d.src=a;d.listener=c;if(a.addEventListener)a.addEventListener(b.toString(),d,g);else if(a.attachEvent)a.attachEvent(hh(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");bh++}}function gh(){var a=ih,b=Gg?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}
function jh(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)jh(a,b[f],c,d,e);else c=dh(c),a&&a[Tg]?a.M.add(String(b),c,!0,d,e):eh(a,b,c,!0,d,e)}function kh(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)kh(a,b[f],c,d,e);else(c=dh(c),a&&a[Tg])?(a=a.M,b=String(b).toString(),b in a.a&&(f=a.a[b],c=Yg(f,c,d,e),-1<c&&(Wg(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=fh(a))&&(b=a.a[b.toString()],a=-1,b&&(a=Yg(b,c,!!d,e)),(c=-1<a?b[a]:null)&&lh(c))}
function lh(a){if(!y(a)&&a&&!a.X){var b=a.src;if(b&&b[Tg])Zg(b.M,a);else{var c=a.type,d=a.a;b.removeEventListener?b.removeEventListener(c,d,a.qa):b.detachEvent&&b.detachEvent(hh(c),d);bh--;(c=fh(b))?(Zg(c,a),0==c.b&&(c.src=null,b[$g]=null)):Wg(a)}}}function hh(a){return a in ah?ah[a]:ah[a]="on"+a}function mh(a,b,c,d){var e=!0;if(a=fh(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.qa==c&&!f.X&&(f=nh(f,d),e=e&&!1!==f)}return e}
function nh(a,b){var c=a.listener,d=a.ua||a.src;a.pa&&lh(a);return c.call(d,b)}
function ih(a,b){if(a.X)return!0;if(!Gg){var c=b||aa("window.event"),d=new Ig(c,this),e=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(l){f=!0}if(f||void 0==c.returnValue)c.returnValue=!0}c=[];for(f=d.a;f;f=f.parentNode)c.push(f);for(var f=a.type,g=c.length-1;0<=g;g--){d.a=c[g];var h=mh(c[g],f,!0,d),e=e&&h}for(g=0;g<c.length;g++)d.a=c[g],h=mh(c[g],f,!1,d),e=e&&h}return e}return nh(a,new Ig(b,this))}
function fh(a){a=a[$g];return a instanceof Xg?a:null}var oh="__closure_events_fn_"+(1E9*Math.random()>>>0);function dh(a){if(z(a))return a;a[oh]||(a[oh]=function(b){return a.handleEvent(b)});return a[oh]};function ph(){Nd.call(this);this.M=new Xg(this);this.b=this;this.a=null}C(ph,Nd);ph.prototype[Tg]=!0;ph.prototype.addEventListener=function(a,b,c,d){ch(this,a,b,c,d)};ph.prototype.removeEventListener=function(a,b,c,d){kh(this,a,b,c,d)};ph.prototype.L=function(){ph.u.L.call(this);if(this.M){var a=this.M,b=0,c;for(c in a.a){for(var d=a.a[c],e=0;e<d.length;e++)++b,Wg(d[e]);delete a.a[c];a.b--}}this.a=null};
function qh(a,b,c,d){b=a.M.a[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.X&&g.qa==c){var h=g.listener,l=g.ua||g.src;g.pa&&Zg(a.M,g);e=!1!==h.call(l,d)&&e}}return e&&0!=d.Xa};function rh(a){a.i||(a.i=new ph);return a.i}Y.prototype.addEventListener=function(a,b,c,d){if("ready"==a)jh(rh(this),a,b,c,d);else{var e="created error fail ready deleted updated versionchange".split(" "),f=function(a){if(!(0<=D(e,a)))throw new K('Invalid event type "'+a+'"');};if(w(a))for(var g=0;g<a.length;g++)f(a[g]);else f(a);ch(rh(this),a,b,c,d)}};Y.prototype.removeEventListener=function(a,b,c,d){kh(rh(this),a,b,c,d)};
Y.prototype.B=function(a){var b=rh(this),c,d=b.a;if(d)for(c=[];d;d=d.a)c.push(d);b=b.b;d=a.type||a;if(x(a))a=new Qd(a,b);else if(a instanceof Qd)a.target=a.target||b;else{var e=a;a=new Qd(d,b);cb(a,e)}var e=!0,f;if(c)for(var g=c.length-1;0<=g;g--)f=a.a=c[g],e=qh(f,d,!0,a)&&e;f=a.a=b;e=qh(f,d,!0,a)&&e;e=qh(f,d,!1,a)&&e;if(c)for(g=0;g<c.length;g++)f=a.a=c[g],e=qh(f,d,!1,a)&&e};Y.prototype.addEventListener=Y.prototype.addEventListener;Y.prototype.removeEventListener=Y.prototype.removeEventListener;dg.prototype.countOf=dg.prototype.ba;dg.prototype.keysOf=dg.prototype.ea;dg.prototype.open=dg.prototype.open;dg.prototype.scan=dg.prototype.Eb;dg.prototype.valuesOf=dg.prototype.ja;Wf.prototype.countOf=Wf.prototype.ba;Wf.prototype.keysOf=Wf.prototype.ea;Wf.prototype.open=Wf.prototype.open;Wf.prototype.scan=Wf.prototype.Za;Wf.prototype.valuesOf=Wf.prototype.ja;We.prototype.getKey=We.prototype.Fb;We.prototype.getPrimaryKey=We.prototype.na;We.prototype.getValue=We.prototype.Na;We.prototype.update=We.prototype.update;
We.prototype.clear=We.prototype.clear;ka("ydn.db.Iterator",U);ka("ydn.db.KeyIterator",df);ka("ydn.db.ValueIterator",ff);ka("ydn.db.IndexIterator",ef);ka("ydn.db.IndexValueIterator",gf);U.prototype.getState=U.prototype.kb;U.prototype.getKeyRange=U.prototype.vb;U.prototype.getIndexName=U.prototype.tb;U.prototype.getStoreName=U.prototype.xb;U.prototype.isReversed=U.prototype.P;U.prototype.isUnique=U.prototype.za;U.prototype.isKeyIterator=U.prototype.yb;U.prototype.isIndexIterator=U.prototype.lb;
U.prototype.getPrimaryKey=U.prototype.wb;U.prototype.getKey=U.prototype.ub;U.prototype.resume=U.prototype.zb;U.prototype.reset=U.prototype.reset;U.prototype.reverse=U.prototype.reverse;df.where=function(a,b,c,d,e){return new df(a,ie(b,c,d,e))};ff.where=function(a,b,c,d,e){return new ff(a,ie(b,c,d,e))};ef.where=function(a,b,c,d,e,f){return new ef(a,b,ie(c,d,e,f))};gf.where=function(a,b,c,d,e,f){return new gf(a,b,ie(c,d,e,f))};ka("ydn.db.Streamer",mf);mf.prototype.push=mf.prototype.push;
mf.prototype.collect=mf.prototype.Cb;mf.prototype.setSink=mf.prototype.pb;function sh(a,b){pf.call(this,a,b)}C(sh,pf);sh.prototype.i=function(){return!1};sh.prototype.f=function(a,b){function c(b){r(a[b])?(e=!1,d[b]=!0):(d[b]=!1,0<=b-1&&c(b-1))}var d=[],e=!0;c(a.length-1);e&&(d=[]);return qf(this,d,b)};function th(a,b){pf.call(this,a,b)}C(th,pf);
th.prototype.f=function(a,b){var c=[],d=b[0];if(null==d)return[];for(var e=!0,f=!1,g=d,h=[],l=1;l<a.length;l++)if(null!=b[l]){var p=Kd(d,b[l]);h[l]=p;this.b?-1==p?e=!1:1==p&&(e=!1,f=!0,-1==Kd(b[l],g)&&(g=b[l])):1==p?e=!1:-1==p&&(e=!1,f=!0,1==Kd(b[l],g)&&(g=b[l]))}else e=!1,f=!0;if(e)for(f=0;f<a.length;f++)null!=b[f]&&(c[f]=!0);else if(f)for(f=0;f<a.length;f++)null!=b[f]&&(this.b?-1==Kd(g,b[f])&&(c[f]=g):1==Kd(g,b[f])&&(c[f]=g));else for(l=this.b?-1:1,f=1;f<a.length;f++)h[f]===l&&(c[f]=d);return e?
(this.h++,this.a&&this.a.push(g),c):{continuePrimary:c}};function uh(a,b){pf.call(this,a,b)}C(uh,pf);uh.prototype.logger=H("ydn.db.algo.ZigzagMerge");
uh.prototype.f=function(a,b){function c(a,b){var c=a.slice(0,a.length-1);c.push(b);return c}function d(a){return a[a.length-1]}var e=[];if(0==a.length||null==a[0]||null==a[0])return[];for(var f=!0,g=0,h=d(a[g]),l=[],p=1;p<a.length;p++)if(null!=a[p]){var t=d(a[p]),m=Kd(h,t);l[p]=m;this.b?-1==m?f=!1:1==m&&(f=!1,h=t,g=1):1==m?f=!1:-1==m&&(f=!1,h=t,g=1)}else return[];p=this.b?-1:1;if(f){for(f=0;f<a.length;f++)null!=a[f]&&(e[f]=!0);this.a&&(this.g?this.a.push(b[0],h):this.a.push(b[0]));return null!=this.c&&
this.a.length>=this.c?[]:e}if(0==g)for(f=1;f<a.length;f++)l[f]==p&&(e[f]=c(a[f],h));else for(f=0;f<a.length;f++)f!=g&&null!=a[f]&&Kd(h,d(a[f]))===p&&(e[f]=c(a[f],h));return{"continue":e}};ka("ydn.db.algo.NestedLoop",sh);ka("ydn.db.algo.ZigzagMerge",uh);ka("ydn.db.algo.SortedMerge",th); 

//# sourceMappingURL=ydn.db-i-core-e-cur-dev.js.map
return ydn;}, (this || {}));
            